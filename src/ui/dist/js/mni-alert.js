let ready=null,retryMs=5e3,refreshMs=3e5,chartAlert=null,availableAlert=0,activeCallback=0,activePublish=0,activeNotify=0,activeWorkflow=0,fmaReady=null,fmalReady=null,umaReady=null;function fetchStats(){null!=ready&&clearTimeout(ready),fetch(localStorage.getItem("mni.gatewayUrl")+"/ui/statistic",{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();ready=setTimeout(fetchStats,refreshMs,e.status)})).then((e=>{null!=e.alerts&&(null!=e.alerts?.available&&(availableAlert=toInteger(e.alerts.available)),null!=e.alerts?.active?.callbacks&&(activeCallback=toInteger(e.alerts.active.callbacks)),null!=e.alerts?.active?.publish&&(activePublish=toInteger(e.alerts.active.publish)),null!=e.alerts?.active?.notify&&(activeNotify=toInteger(e.alerts.active.notify)),null!=e.alerts?.active?.workflow&&(activeWorkflow=toInteger(e.alerts.active.workflow))),Chart.defaults.font.family="Lato",null!=chartAlert?(chartAlert.data.datasets[0].data[0]=availableAlert,chartAlert.data.datasets[1].data[1]=activeCallback,chartAlert.data.datasets[1].data[2]=activePublish,chartAlert.data.datasets[1].data[3]=activeNotify,chartAlert.data.datasets[1].data[4]=activeWorkflow,chartAlert.update()):chartAlert=new Chart("alertSummary",{type:"bar",options:{indexAxis:"y",responsive:!0,scales:{x:{display:!1,stacked:!0,grid:{display:!1},scales:{x:{display:!1}}},y:{stacked:!0,grid:{display:!1}}},plugins:{legend:{display:!1}}},data:{labels:["Available",["Active","Callbacks"],["Active","Publish"],["Active","Notify"],["Active","Workflows"]],datasets:[{data:[availableAlert,0,0,0,0],backgroundColor:"rgba(0,128,0,1)",hoverBackgroundColor:"rgba(10,99,10,1)"},{data:[0,activeCallback,activePublish,activeNotify,activeWorkflow],backgroundColor:"rgba(54, 162, 235,1)",hoverBackgroundColor:"rgba(26, 122, 186,1)"}]}}),ready=setTimeout(fetchStats,refreshMs)})).catch((e=>{ready=setTimeout(fetchStats,refreshMs)}))}function firstMasterAlert(){let e=document.getElementById("alert");e.selectedIndex,e.length>1&&(e.selectedIndex=1,fetchMasterAlert(),document.getElementById("meter").setAttribute("value",1))}function previousMasterAlert(){let e=document.getElementById("alert"),t=e.selectedIndex;e.length,t>=2&&(e.selectedIndex=t-1,fetchMasterAlert(),document.getElementById("meter").setAttribute("value",t-1))}function nextMasterAlert(){let e=document.getElementById("alert"),t=e.selectedIndex;t<e.length-1&&(e.selectedIndex=t+1,fetchMasterAlert(),document.getElementById("meter").setAttribute("value",t+1))}function lastMasterAlert(){let e=document.getElementById("alert"),t=e.selectedIndex,a=e.length-1;t<a&&a>1&&(e.selectedIndex=a,fetchMasterAlert(),document.getElementById("meter").setAttribute("value",a))}function updateMasterAlert(){let e=document.getElementById("alert");e.options[e.selectedIndex].value,null!=umaReady&&clearTimeout(umaReady)}function deleteMasterAlert(){let e=document.getElementById("alert"),t=e.options[e.selectedIndex].value;null!=t&&"-1"!=t&&fetch(localStorage.getItem("mni.gatewayUrl")+"/alert/"+t,{method:"DELETE",keepalive:!0}).then((e=>{e.ok?(notify("Deleted"),previousMasterAlert(),fetchMasterAlertList()):notify("Failed to delete provider")})).catch((e=>{notify(e)}))}function redisplayMasterAlert(){let e=document.getElementById("alert");"-1"==e.options[e.selectedIndex].value?clearMasterAlert():fetchMasterAlert()}function newMasterAlert(){document.getElementById("alert").value="-1",clearMasterAlert()}function saveMasterAlert(){let e=document.getElementById("alert"),t=e.options[e.selectedIndex].value;if(document.getElementById("alertDescription").value.length>0&&document.getElementById("alertFunction").value.length>0)if("-1"==t){let e=null;e={description:document.getElementById("alertDescription").value,function:document.getElementById("alertFunction").value},fetch(localStorage.getItem("mni.gatewayUrl")+"/alert",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e),keepalive:!0}).then((e=>{if(e.ok)return notify("Saved"),e.json()})).then((e=>{fetchMasterAlertList(),lastMasterAlert()})).catch((e=>{notify(e)}))}else{let e=null;e={description:document.getElementById("alertDescription").value,function:document.getElementById("alertFunction").value},fetch(localStorage.getItem("mni.gatewayUrl")+"/alert/"+t,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),keepalive:!0}).then((e=>{e.ok?notify("Updated"):notify("Failed to save change")})).catch((e=>{notify(e)}))}else notify("description must be supplied")}function clearMasterAlert(){document.getElementById("alertDescription").value="",document.getElementById("alertFunction").value=""}function displayMasterAlert(e){clearMasterAlert();let t=document.getElementById("alert");t.options[t.selectedIndex].value,void 0!==e&&null!=e&&(document.getElementById("alertDescription").value=e.description,document.getElementById("alertFunction").value=e.function)}function fetchMasterAlert(){null!=fmaReady&&clearTimeout(fmaReady);let e=document.getElementById("alert"),t=e.options[e.selectedIndex].value;null!=t&&"-1"!=t?fetch(localStorage.getItem("mni.gatewayUrl")+"/alert/"+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();fmaReady=setTimeout(fetchMasterAlert,retryMs)})).then((e=>{displayMasterAlert(e)})).catch((e=>{fmaReady=setTimeout(fetchMasterAlert,retryMs)})):fmaReady=setTimeout(fetchMasterAlert,retryMs)}function fetchMasterAlertList(){null!=fmalReady&&clearTimeout(fmalReady),fetch(localStorage.getItem("mni.gatewayUrl")+"/alert",{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();fmalReady=setTimeout(fetchMasterAlertList,retryMs)})).then((e=>{let t="<option disabled value='-1' selected='selected'> -- new provider -- </option>";for(var a=0;a<e.length;a++)t+=0==a?"<option value='"+e[a]+"' selected='selected'>"+e[a]+"</option>":"<option value='"+e[a]+"' >"+e[a]+"</option>";document.getElementById("alert").innerHTML=t,e.length>0?(document.getElementById("meter").setAttribute("min",1),document.getElementById("meter").setAttribute("value",1)):(document.getElementById("meter").setAttribute("value",0),document.getElementById("meter").setAttribute("min",0)),document.getElementById("meter").setAttribute("max",e.length),fetchMasterAlert()})).catch((e=>{fmalReady=setTimeout(fetchMasterAlertList,retryMs)}))}try{fetchMasterAlertList()}catch(e){fmalReady=setTimeout(fetchMasterAlertList,retryMs)}try{fetchStats()}catch(e){ready=setTimeout(fetchStats,refreshMs)}