let cableId=null,cableRawPoints=[],point=null;function fetchListCable(){fetch(localStorage.getItem("mni.gatewayUrl")+"/cable?country="+mniSelectedCountry,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{let t=window.location.pathname.replace(localStorage.getItem("mni.rootUrl")+"/cable/",""),s="<option disabled value='-1' selected='selected'> -- select a cable -- </option>";null!=t&&(trenchIds="<option disabled value='-1'> -- select a cable -- </option>");for(var a=0;a<e.length;a++)t==e[a]?s+="<option value='"+e[a]+"' selected='selected'>"+e[a]+"</option>":s+="<option value='"+e[a]+"' >"+e[a]+"</option>";document.getElementById("cableId").innerHTML=s,null!=t&&fetchCablePoints()})).catch((e=>{console.error(e)}))}function fetchCable(e,t=null){if(null==e){let t=document.getElementById("cableId");e=t.options[t.selectedIndex].value}if(null==t){let e=document.getElementById("cablePoint");t=e.options[e.selectedIndex].value}let s=document.querySelector(".grid");for(;s.firstChild;)s.removeChild(s.firstChild);fetch(localStorage.getItem("mni.gatewayUrl")+"/cable/"+e+"?point="+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((t=>{if(null!=t.configuration){let a=0,r=1,c=48,i=24,l=0,n=0,o=0,d=0,b=document.getElementById("country"),u=b.options[b.selectedIndex].value,p="historical";switch(null!=t.source&&(p=t.source),t.technology){case"coax":case"copper":case"ethernet":a=1,r=1;break;case"singleFiber":a=1,r=t.configuration.strands;break;case"multiFiber":a=t.configuration.ribbons,r=t.configuration.strands}r>c&&(i=Math.max(Math.ceil(r/c),c)),s.style.setProperty("--max-cable-rows",c),s.style.setProperty("--max-cable-columns",i);for(let e=0;e<a;e++)for(let a=0;a<r;a++){let r=document.createElement("div");switch(r.setAttribute("id","cable"+e+"-"+a),t.technology){case"coax":switch(r.setAttribute("title",t.configuration.state),t.configuration.state){case"free":r.setAttribute("title",t.configuration.state),"predicted"==p?r.setAttribute("class","predictedCableFree"):r.setAttribute("class","cableFree"),n+=1;break;case"used":"predicted"==p?r.setAttribute("class","predictedCableUsed"):r.setAttribute("class","cableUsed"),l+=1;break;case"reserved":"predicted"==p?r.setAttribute("class","predictedCableReserved"):r.setAttribute("class","cableReserved"),o+=1;break;case"faulty":"predicted"==p?r.setAttribute("class","predictedCableFaulty"):r.setAttribute("class","cableFaulty"),d+=1}break;case"copper":case"ethernet":switch(r.setAttribute("title",t.configuration.state),t.configuration.state){case"free":"predicted"==p?r.setAttribute("class","predictedCableFree"):r.setAttribute("class","cableFree"),n+=1;break;case"used":"predicted"==p?r.setAttribute("class","predictedCableUsed"):r.setAttribute("class","cableUsed"),l+=1;break;case"reserved":"predicted"==p?r.setAttribute("class","predictedCableReserved"):r.setAttribute("class","cableReserved"),o+=1;break;case"faulty":"predicted"==p?r.setAttribute("class","predictedCableFaulty"):r.setAttribute("class","cableFaulty"),d+=1}break;case"singleFiber":switch(r.setAttribute("title",t.configuration.states[a].strand+" "+t.configuration.states[a].state),t.configuration.states[a].state){case"free":"predicted"==p?r.setAttribute("class","predictedCableFree"):r.setAttribute("class","cableFree"),n+=1;break;case"used":"predicted"==p?r.setAttribute("class","predictedCableUsed"):r.setAttribute("class","cableUsed"),l+=1;break;case"reserved":"predicted"==p?r.setAttribute("class","predictedCableReserved"):r.setAttribute("class","cableReserved"),o+=1;break;case"faulty":"predicted"==p?r.setAttribute("class","predictedCableFaulty"):r.setAttribute("class","cableFaulty"),d+=1}break;case"multiFiber":switch(r.setAttribute("title",e+1+"."+(a+1)+" "+t.configuration.states[a].state),t.configuration.states[a].state){case"free":"predicted"==p?r.setAttribute("class","predictedCableFree"):r.setAttribute("class","cableFree"),n+=1;break;case"used":"predicted"==p?r.setAttribute("class","predictedCableUsed"):r.setAttribute("class","cableUsed"),l+=1;break;case"reserved":"predicted"==p?r.setAttribute("class","predictedCableReserved"):r.setAttribute("class","cableReserved"),o+=1;break;case"faulty":"predicted"==p?r.setAttribute("class","predictedCableFaulty"):r.setAttribute("class","cableFaulty"),d+=1}}switch(r.classList.add("cell"),s.appendChild(r),t.technology){case"coax":case"copper":case"ethernet":case"singleFiber":document.getElementById("cable"+e+"-"+a).innerHTML="<br>"+(a+1);break;case"multiFiber":document.getElementById("cable"+e+"-"+a).innerHTML="<br>"+(e+1)+"."+(a+1)}}let m="<b>Reference:</b>&emsp;"+t.reference+"</b>&emsp;( "+e+" )<br>&emsp;Source:&emsp;"+t.source+"<br>";switch(t.technology){case"coax":m=m+"<br><b>Technology</b>:<br>&emsp;Type:&emsp;Coax<br>&emsp;Frequency Range:&emsp;"+t.configuration.frequencyRange.low+t.configuration.unit+" to "+t.configuration.frequencyRange.high+t.configuration.unit+"<br>&emsp;Channels:&emsp;"+t.configuration.channels+" of "+t.configuration.width+t.configuration.unit+"<br>";break;case"copper":m=m+"<br><b>Technology</b>:<br>&emsp;Type:&emsp;Copper<br>&emsp;Twisted Pairs:&emsp;"+t.configuration.twistedPairs+"<br>";break;case"ethernet":m=m+"<br><b>Technology</b>:<br>&emsp;Type:&emsp;Ethernet<br>&emsp;Category:&emsp;"+t.configuration.category+"<br>&emsp;Transmission:&emsp;"+t.configuration.rate+t.configuration.unit+"<br>";break;case"singleFiber":m=m+"<br><b>Technology</b>:<br>&emsp;Type:&emsp;Single-Fiber<br>&emsp;Strands:&emsp;"+t.configuration.strands+"<br>&emsp;Mode:&emsp;"+t.configuration.mode+"<br>&emsp;Transmission:&emsp;"+t.configuration.rate+t.configuration.unit+" per strand<br>";break;case"multiFiber":m=m+"<br><b>Technology</b>:<br>&emsp;Type:&emsp;Multi-Fiber<br>&emsp;Ribbons.Strands:&emsp;"+t.configuration.ribbons+"."+t.configuration.strands+"<br>&emsp;Mode:&emsp;"+t.configuration.mode+"<br>&emsp;Transmission:&emsp;"+t.configuration.rate+t.configuration.unit+" per strand<br>"}m+="<br><b>Location</b>:<br>",null!=t.ductId&&(m=m+'&emsp;Duct:&emsp;<a href="'+localStorage.getItem("mni.rootUrl")+"/duct/"+t.ductId+"?country="+u+'" target="_self">'+t.ductId+"</a><br>"),null!=t.poleId&&(m=m+'&emsp;Pole:&emsp;<a href="'+localStorage.getItem("mni.rootUrl")+"/pole/"+t.poleId+"?country="+u+'" target="_self">'+t.poleId+"</a><br>"),m=m+'<br><b>Usage Summary:</b><br><div class="stateusage-key"><div id="stateusage-faulty" class="stateusage">Faulty: '+d+'</div><div id="stateusage-reserved" class="stateusage">Reserved: '+o+'</div><div id="stateusage-used" class="stateusage">Used: '+l+'</div><div id="stateusage-free" class="stateusage">Free: '+n+"</div></div>",document.getElementById("metadataPanel").innerHTML=m}})).catch((e=>{console.error(e)}))}function fetchCablePoints(){let e=document.getElementById("cableId");cableId=e.options[e.selectedIndex].value,"-1"!=cableId&&fetch(localStorage.getItem("mni.gatewayUrl")+"/cable/timeline/"+cableId,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{cableRawPoints=[];let t="<option disabled value='-1'> -- select a date/time -- </option>";for(var s=0;s<e.length;s++)t+=0==s?"<option selected='selected' value='"+e[s].point+"' >"+e[s].point+"</option>":"<option value='"+e[s].point+"' >"+e[s].point+"</option>",cableRawPoints.push(e[s].point);document.getElementById("cablePoint").innerHTML=t,fetchCable()})).catch((e=>{console.error(e)}))}try{countryListPopulate(fetchListCable)}catch(e){console.error(e)}