let retryMs=1e3,refreshMs=3e5,fpReady=null,dpReady=null,spReady=null,fplReady=null;function firstProvider(){let e=document.getElementById("provider");e.selectedIndex,e.length>1&&(e.selectedIndex=1,fetchProvider(),document.getElementById("meter").setAttribute("value",1))}function previousProvider(){let e=document.getElementById("provider"),t=e.selectedIndex;e.length,t>=2&&(e.selectedIndex=t-1,fetchProvider(),document.getElementById("meter").setAttribute("value",t-1))}function nextProvider(){let e=document.getElementById("provider"),t=e.selectedIndex;t<e.length-1&&(e.selectedIndex=t+1,fetchProvider(),document.getElementById("meter").setAttribute("value",t+1))}function lastProvider(){let e=document.getElementById("provider"),t=e.selectedIndex,n=e.length-1;t<n&&n>1&&(e.selectedIndex=n,fetchProvider(),document.getElementById("meter").setAttribute("value",n))}function deleteProvider(){let e=document.getElementById("provider"),t=e.options[e.selectedIndex].value;null!=t&&"-1"!=t&&fetch(localStorage.getItem("mni.gatewayUrl")+"/admin/email/provider/"+t,{method:"DELETE",keepalive:!0}).then((e=>{e.ok?(previousProvider(),fetchProviderList()):window.alert(`Failed to delete provider ${t}`)})).catch((e=>{notify(e)}))}function redisplayProvider(){let e=document.getElementById("provider");"-1"==e.options[e.selectedIndex].value?clearProvider():fetchProvider()}function newProvider(){document.getElementById("provider").value="-1",clearProvider()}function saveProvider(){let e=document.getElementById("provider"),t=e.options[e.selectedIndex].value,n=document.getElementById("vendor").value;if(null!=n)if(document.getElementById("address").value.length>0)if(document.getElementById("sendUsername").value.length>0)if(document.getElementById("sendPassword").value.length>0)if(document.getElementById("sendHost").value.length>0)if(document.getElementById("sendHost").value.length>0){if("-1"!=document.getElementById("sendAuthentication").value){let e=null;if(document.getElementById("sendUsername").value.length>0&&document.getElementById("receiveUsername").value.length>0){let t=document.getElementById("sendProtocol"),d=t.options[t.selectedIndex].value,o=document.getElementById("sendAuthentication"),l=o.options[o.selectedIndex].value,r=document.getElementById("receiveProtocol"),c=r.options[r.selectedIndex].value;e={vendor:n,address:document.getElementById("address").value,name:document.getElementById("name").value,send:{username:document.getElementById("sendUsername").value,password:document.getElementById("sendPassword").value,host:document.getElementById("sendHost").value,port:toInteger(document.getElementById("sendPort").value),protocol:d,authentication:l,encryption:{enabled:document.getElementById("sendEncryptionEnabled").checked,starttls:document.getElementById("sendEncryptionStartTls").checked}},receive:{username:document.getElementById("receiveUsername").value,password:document.getElementById("receivePassword").value,host:document.getElementById("receiveHost").value,port:toInteger(document.getElementById("receivePort").value),protocol:c,encryption:{enabled:document.getElementById("receiveEncryptionEnabled").checked,starttls:document.getElementById("receiveEncryptionStartTls").checked},rootFolder:document.getElementById("receiveRootFolder").value,folderSeparator:document.getElementById("receiveFolderSeparator").value}}}else if(document.getElementById("sendUsername").value.length>0&&0==document.getElementById("receiveUsername").value.length){let t=document.getElementById("sendProtocol"),d=t.options[t.selectedIndex].value,o=document.getElementById("sendAuthentication"),l=o.options[o.selectedIndex].value;e={vendor:n,address:document.getElementById("address").value,name:document.getElementById("name").value,send:{username:document.getElementById("sendUsername").value,password:document.getElementById("sendPassword").value,host:document.getElementById("sendHost").value,port:toInteger(document.getElementById("sendPort").value),protocol:d,authentication:l,encryption:{enabled:document.getElementById("sendEncryptionEnabled").checked,starttls:document.getElementById("sendEncryptionStartTls").checked}}}}"-1"==t?fetch(localStorage.getItem("mni.gatewayUrl")+"/admin/email/provider",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e),keepalive:!0}).then((e=>{e.ok&&(fetchProviderList(),lastProvider())})).catch((e=>{window.alert(e)})):(e.emailProviderId=t,fetch(localStorage.getItem("mni.gatewayUrl")+"/admin/email/provider/"+t,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e),keepalive:!0}).then((e=>{e.ok||window.alert(`Failed to update provider ${t}`)})).catch((e=>{window.alert(e)})))}}else window.alert("Sending authentication scheme must be specified");else window.alert("Sending host must be specified");else window.alert("Sending password must be specified");else window.alert("Sending username must be specified");else window.alert("Address must be specified");else window.alert("Vendor must be specified")}function clearProvider(){document.getElementById("vendor").value="",document.getElementById("address").value="",document.getElementById("name").value="",document.getElementById("sendUsername").value="",document.getElementById("sendPassword").value="",document.getElementById("sendHost").value="",document.getElementById("sendPort").value="465",document.getElementById("sendProtocol").value="-1",document.getElementById("sendAuthentication").value="-1",document.getElementById("sendEncryptionEnabled").checked=!0,document.getElementById("receiveUsername").value="",document.getElementById("receivePassword").value="",document.getElementById("receivePort").value="993",document.getElementById("receiveProtocol").value="-1",document.getElementById("receiveRootFolder").value="",document.getElementById("receiveFolderSeparator").value="/",document.getElementById("send").style.display="block",document.getElementById("receive").style.display="block"}function displayProvider(e){clearProvider();let t=document.getElementById("provider");t.options[t.selectedIndex].value,void 0!==e&&null!=e&&(document.getElementById("vendor").value=e.vendor,document.getElementById("address").value=e.address,document.getElementById("name").value=e.name,null!=e?.send?(document.getElementById("send").style.display="block",document.getElementById("sendUsername").value=e.send.username,document.getElementById("sendPassword").value=e.send.password,document.getElementById("sendHost").value=e.send.host,document.getElementById("sendPort").value=e.send.port,document.getElementById("sendProtocol").value=e.send.protocol,document.getElementById("sendAuthentication").value=e.send.authentication,document.getElementById("sendEncryptionEnabled").value=e.send.encryption.enabled,document.getElementById("sendEncryptionStartTls").value=e.send.encryption.starttls):document.getElementById("send").style.display="none",null!=e?.receive?(document.getElementById("receive").style.display="block",document.getElementById("receiveUsername").value=e.receive.username,document.getElementById("receivePassword").value=e.receive.password,document.getElementById("receiveHost").value=e.receive.host,document.getElementById("receivePort").value=e.receive.port,document.getElementById("receiveProtocol").value=e.receive.protocol,document.getElementById("receiveEncryptionEnabled").value=e.receive.encryption.enabled,document.getElementById("receiveEncryptionStartTls").value=e.receive.encryption.starttls,document.getElementById("receiveRootFolder").value=e.receive.rootFolder,document.getElementById("receiveFolderSeparator").value=e.receive.folderSeparator):document.getElementById("receive").style.display="none")}function fetchProvider(){null!=fpReady&&clearTimeout(fpReady);let e=document.getElementById("provider"),t=e.options[e.selectedIndex].value;null!=t&&fetch(localStorage.getItem("mni.gatewayUrl")+"/admin/email/provider/"+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{displayProvider(e)})).catch((e=>{notify(e)}))}function fetchProviderList(){null!=fplReady&&clearTimeout(fplReady),fetch(localStorage.getItem("mni.gatewayUrl")+"/admin/email/provider",{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{let t="<option disabled value='-1' selected='selected'> -- new provider -- </option>";for(var n=0;n<e.length;n++)t+=0==n?"<option value='"+e[n]+"' selected='selected'>"+e[n]+"</option>":"<option value='"+e[n]+"' >"+e[n]+"</option>";document.getElementById("provider").innerHTML=t,e.length>0?(document.getElementById("meter").setAttribute("min",1),document.getElementById("meter").setAttribute("value",1)):(document.getElementById("meter").setAttribute("value",0),document.getElementById("meter").setAttribute("min",0)),document.getElementById("meter").setAttribute("max",e.length),fetchProvider()})).catch((e=>{notify(e)}))}try{fetchProviderList()}catch(e){notify(e)}