let retryMs=1e3,refreshMs=3e5,fpReady=null,dpReady=null,spReady=null,fplReady=null;function firstProvider(){let e=document.getElementById("provider");e.selectedIndex,e.length>1&&(e.selectedIndex=1,fetchProvider(),document.getElementById("meter").setAttribute("value",1))}function previousProvider(){let e=document.getElementById("provider"),t=e.selectedIndex;e.length,t>=2&&(e.selectedIndex=t-1,fetchProvider(),document.getElementById("meter").setAttribute("value",t-1))}function nextProvider(){let e=document.getElementById("provider"),t=e.selectedIndex;t<e.length-1&&(e.selectedIndex=t+1,fetchProvider(),document.getElementById("meter").setAttribute("value",t+1))}function lastProvider(){let e=document.getElementById("provider"),t=e.selectedIndex,d=e.length-1;t<d&&d>1&&(e.selectedIndex=d,fetchProvider(),document.getElementById("meter").setAttribute("value",d))}function deleteProvider(){let e=document.getElementById("provider"),t=e.options[e.selectedIndex].value;null!=t&&"-1"!=t&&(document.getElementById("systemDefault").checked?window.alert("Can not delete the default provider !"):fetch("<%=payload.gatewayUrl%>/admin/map/provider/"+t,{method:"DELETE",keepalive:!0}).then((e=>{e.ok?(previousProvider(),fetchProviderList()):window.alert(`Failed to delete provider ${t}`)})).catch((e=>{})))}function redisplayProvider(){let e=document.getElementById("provider");"-1"==e.options[e.selectedIndex].value?clearProvider():fetchProvider()}function newProvider(){document.getElementById("provider").value="-1",clearProvider()}function saveProvider(){let e=document.getElementById("provider"),t=e.options[e.selectedIndex].value,d=document.getElementById("vendor"),n=d.options[d.selectedIndex].value,l=document.getElementById("systemDefault").checked||!1,o=null;"-1"!=n?document.getElementById("renderUrl").value.length>0?document.getElementById("credentialKey").value.length>0||document.getElementById("idpBase").value.length>0?(document.getElementById("credentialKey").value.length>0?o={vendor:n,default:l,renderUrl:document.getElementById("renderUrl").value,credentials:{identity:document.getElementById("credentialIdentity").value,key:document.getElementById("credentialKey").value}}:document.getElementById("idpBase").value.length>0&&(o={vendor:n,default:l,renderUrl:document.getElementById("renderUrl").value,identityProvider:{base:document.getElementById("idpBase").value,authorization:document.getElementById("idpAuthorization").value,token:document.getElementById("idpToken").value,wellKnown:document.getElementById("idpWellKnown").value}}),"-1"==t?fetch("<%=payload.gatewayUrl%>/admin/map/provider",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o),keepalive:!0}).then((e=>{e.ok&&(fetchProviderList(),lastProvider())})).catch((e=>{window.alert(e)})):(o.mapProviderId=t,fetch("<%=payload.gatewayUrl%>/admin/map/provider/"+t,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),keepalive:!0}).then((e=>{e.ok||window.alert(`Failed to update provider ${t}`)})).catch((e=>{window.alert(e)})))):window.alert("Either credentials identity/key must be suppied or identity Provider base/authorization/token/Well-Known URLs"):window.alert("Render URL must be supplied"):window.alert("Vendor must be selected")}function clearProvider(){document.getElementById("vendor").value="-1",document.getElementById("systemDefault").checked=!1,document.getElementById("renderUrl").value="",document.getElementById("credentialIdentity").value="",document.getElementById("credentialKey").value="",document.getElementById("idpBase").value="",document.getElementById("idpAuthorization").value="",document.getElementById("idpToken").value="",document.getElementById("idpWellKnown").value="",document.getElementById("credential").style.display="block",document.getElementById("idp").style.display="block"}function displayProvider(e){clearProvider();let t=document.getElementById("provider");if(t.options[t.selectedIndex].value,void 0!==e&&null!=e)switch(e.vendor){case"Google Maps":case"OpenStreet Map":case"Microsoft Azure":case"ERSI":document.getElementById("vendor").value=e.vendor;break;default:document.getElementById("vendor").value="-1"}document.getElementById("systemDefault").checked=e.default,document.getElementById("renderUrl").value=e.renderUrl,null!=e.credentials?(document.getElementById("credentialIdentity").value=e.credentials.identity,document.getElementById("credentialKey").value=e.credentials.key,document.getElementById("credential").style.display="block",document.getElementById("idp").style.display="none"):null!=e.identityProvider?(document.getElementById("idpBase").value=e.identityProvider.base,document.getElementById("idpAuthorization").value=e.identityProvider.authorization,document.getElementById("idpToken").value=e.identityProvider.token,document.getElementById("idpWellKnown").value=e.identityProvider.wellKnown,document.getElementById("credential").style.display="none",document.getElementById("idp").style.display="block"):(document.getElementById("credential").style.display="none",document.getElementById("idp").style.display="none")}function fetchProvider(){null!=fpReady&&clearTimeout(fpReady);let e=document.getElementById("provider"),t=e.options[e.selectedIndex].value;null!=t?fetch("<%=payload.gatewayUrl%>/admin/map/provider/"+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();fpReady=setTimeout(fetchProvider,retryMs)})).then((e=>{displayProvider(e)})).catch((e=>{fpReady=setTimeout(fetchProvider,retryMs)})):fpReady=setTimeout(fetchProvider,retryMs)}function fetchProviderList(){null!=fplReady&&clearTimeout(fplReady),fetch("<%=payload.gatewayUrl%>/admin/map/provider",{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();fplReady=setTimeout(fetchProviderList,retryMs)})).then((e=>{let t="<option disabled value='-1' selected='selected'> -- new provider -- </option>";for(var d=0;d<e.length;d++)t+=0==d?"<option value='"+e[d]+"' selected='selected'>"+e[d]+"</option>":"<option value='"+e[d]+"' >"+e[d]+"</option>";document.getElementById("provider").innerHTML=t,e.length>0?(document.getElementById("meter").setAttribute("min",1),document.getElementById("meter").setAttribute("value",1)):(document.getElementById("meter").setAttribute("value",0),document.getElementById("meter").setAttribute("min",0)),document.getElementById("meter").setAttribute("max",e.length),fetchProvider()})).catch((e=>{fplReady=setTimeout(fetchProviderList,retryMs)}))}try{fetchProviderList()}catch(e){fplReady=setTimeout(fetchProviderList,retryMs)}