let flrReady=null,frpReady=null,frReady=null,fvnReady=null,retryMs=5e3,neId=null,point=null;var cveKnown=0,cveImpacting=0;function fetchCveNe(e=null){if(cveKnown=0,cveImpacting=0,null==e){let t=document.getElementById("neId");e=t.options[t.selectedIndex].value}fetch(localStorage.getItem("mni.gatewayUrl")+"/cve/ne/"+e,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{null!=e&&(null!=e.known&&(cveKnown=e.known.length),null!=e.impacting&&(cveImpacting=e.impacting.length))})).catch((e=>{console.error(e)}))}function fetchListNe(){null!=flrReady&&clearTimeout(flrReady),fetch(localStorage.getItem("mni.gatewayUrl")+"/ne",{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();flrReady=setTimeout(fetchListNe,retryMs)})).then((e=>{let t="<option disabled value='-1' selected='selected'> -- select a ne -- </option>";for(var r=0;r<e.length;r++)t+="<option value='"+e[r]+"' >"+e[r]+"</option>";document.getElementById("neId").innerHTML=t})).catch((e=>{console.error(e),flrReady=setTimeout(fetchListNe,retryMs)}))}function fetchNe(e,t=null){if(null!=frReady&&clearTimeout(flrReady),null==e){let t=document.getElementById("neId");e=t.options[t.selectedIndex].value}if(null==t){let e=document.getElementById("nePoint");t=e.options[e.selectedIndex].value}let r=document.querySelector(".grid");for(;r.firstChild;)r.removeChild(r.firstChild);fetch(localStorage.getItem("mni.gatewayUrl")+"/ne/"+e+"?point="+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();flrReady=setTimeout(fetchNe,retryMs)})).then((t=>{if(null!=t.ports){let s=t.ports.length,o=8,n=8,l=0,i=0,c=0,a=0,d=0,m=0,p="historical";null!=t.source&&(p=t.source),console.log("source",p),s>o&&(n=Math.max(Math.ceil(s/o),o)),r.style.setProperty("--max-ne-rows",s),r.style.setProperty("--max-ne-columns",n);for(let e=0;e<t.ports.length;e++){let s=document.createElement("div");switch(s.setAttribute("id","port"+e),s.setAttribute("title",t.ports[e].name+": "+t.ports[e].state+" "+t.ports[e].configuration.rate+t.ports[e].configuration.unit+", errors: "+t.ports[e].errorCount),m+=t.ports[e].errorCount,t.ports[e].state){case"free":"predicted"==p?s.setAttribute("class","predictedPortFree"):s.setAttribute("class","portFree"),i+=1;break;case"used":"predicted"==p?s.setAttribute("class","predictedPortUsed"):s.setAttribute("class","portUsed"),l+=1;break;case"reserved":"predicted"==p?s.setAttribute("class","predictedPortReserved"):s.setAttribute("class","portReserved"),c+=1;break;case"faulty":"predicted"==p?s.setAttribute("class","predictedPortFaulty"):s.setAttribute("class","portFaulty"),a+=1;break;case"predicted":"predicted"==p?s.setAttribute("class","predictedPortPredicted"):s.setAttribute("class","portPredicted"),d+=1}s.classList.add("cell"),r.appendChild(s);let o='<i class="fa fa-check"></i>';t.ports[e].errorCount>0&&t.ports[e].errorCount<100?o='<i class="fa fa fa-exclamation"></i>':t.ports[e].errorCount>=100&&(o='<i class="fa fa-times"></i> '),document.getElementById("port"+e).innerHTML=e+1+"<br>"+o}null==t?.decommissioned&&(t.decommissioned="");let u="<small><b>Host</b>:&emsp;"+t.host+"<br><center>( "+e+" )</center><br><br>Commissioned:&emsp;&emsp;"+t.commissioned+"<br>Decommissioned:&emsp;"+t.decommissioned+"<br>Source:&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"+p+"<br><br><b>Details</b>:<br>IP:&emsp;&emsp;"+t.mgmtIP+"<br>Vendor:&emsp;"+t.vendor+"<br>Model:&emsp;"+t.model+"<br>Image:&emsp;"+t.image+"<br>Version:&emsp;"+t.version+"<br><br><b>Location</b>:<br>Site:&emsp;"+t.siteId+"<br>Rack:&emsp;"+t.rackId+"<br>Slot(s):&emsp;"+t.slotPosition+"<br><br><b>Usage Summary:</b><br>Free:&emsp;&emsp;&emsp;"+i+"<br>Used:&emsp;&emsp;&emsp;"+l+"<br>Reserved:&emsp;"+c+"<br>Faulty:&emsp;&emsp;"+a+"<br>Predicted:&emsp;"+d+"<br>Error Count:&emsp;"+m+"<br><br><b>Common vulnerabilities and Exposures (CVE):</b><br>Known:&emsp;&emsp;"+cveKnown+"<br>Impacting:&emsp;"+cveImpacting+"</small>";document.getElementById("metadataPanel").innerHTML=u}})).catch((e=>{console.error(e),frReady=setTimeout(fetchNe,retryMs)}))}function fetchNePoints(){null!=frpReady&&clearTimeout(frpReady);let e=document.getElementById("neId");neId=e.options[e.selectedIndex].value,"-1"!=neId&&fetch(localStorage.getItem("mni.gatewayUrl")+"/ne/timeline/"+neId,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();frpReady=setTimeout(fetchNePoints,retryMs)})).then((e=>{let t="<option disabled value='-1' selected='selected'> -- select a date/time -- </option>";for(var r=0;r<e.length;r++)t+="<option value='"+e[r].point+"' >"+e[r].point+"</option>";document.getElementById("nePoint").innerHTML=t})).catch((e=>{console.error(e),frpReady=setTimeout(fetchNePoints,retryMs)}))}try{fetchListNe()}catch(e){console.error(e),flrReady=setTimeout(fetchListNe,retryMs)}