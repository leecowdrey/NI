let flrReady=null,frpReady=null,frReady=null,fvnReady=null,retryMs=5e3,neId=null,neRawPoints=[],point=null;var cveKnown=0,cveImpacting=0;function fetchCveNe(e=null){if(cveKnown=0,cveImpacting=0,null==e){let t=document.getElementById("neId");e=t.options[t.selectedIndex].value}fetch(localStorage.getItem("mni.gatewayUrl")+"/cve/ne/"+e,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{null!=e&&(null!=e.known&&(cveKnown=e.known.length),null!=e.impacting&&(cveImpacting=e.impacting.length))})).catch((e=>{notify(e)}))}function updateNePointFromSlider(){document.getElementById("nePoint").value=neRawPoints[neRawPoints.length-document.getElementById("nePointRange").value],fetchNe()}function fetchListNe(){null!=flrReady&&clearTimeout(flrReady);let e=document.getElementById("country"),t=e.options[e.selectedIndex].value;fetch(localStorage.getItem("mni.gatewayUrl")+"/ne?country="+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{let t="<option disabled value='-1' selected='selected'> -- select a ne -- </option>";for(var n=0;n<e.length;n++)t+="<option value='"+e[n]+"' >"+e[n]+"</option>";document.getElementById("neId").innerHTML=t})).catch((e=>{notify(e)}))}function fetchNe(e,t=null){if(null!=frReady&&clearTimeout(flrReady),null==e){let t=document.getElementById("neId");e=t.options[t.selectedIndex].value}if(null==t){let e=document.getElementById("nePoint");t=e.options[e.selectedIndex].value}let n=document.querySelector(".grid");for(;n.firstChild;)n.removeChild(n.firstChild);fetch(localStorage.getItem("mni.gatewayUrl")+"/ne/"+e+"?point="+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((t=>{if(null!=t.ports){let o=t.ports.length,r=8,s=8,i=0,l=0,a=0,d=0,c=0,m=0,p="historical";null!=t.source&&(p=t.source),o>r&&(s=Math.max(Math.ceil(o/r),r)),n.style.setProperty("--max-ne-rows",o),n.style.setProperty("--max-ne-columns",s);for(let e=0;e<t.ports.length;e++){let o=document.createElement("div");switch(o.setAttribute("id","port"+e),o.setAttribute("title",t.ports[e].name+": "+t.ports[e].state+" "+t.ports[e].configuration.rate+t.ports[e].configuration.unit+", errors: "+t.ports[e].errorCount),m+=t.ports[e].errorCount,t.ports[e].state){case"free":"predicted"==p?o.setAttribute("class","predictedPortFree"):o.setAttribute("class","portFree"),l+=1;break;case"used":"predicted"==p?o.setAttribute("class","predictedPortUsed"):o.setAttribute("class","portUsed"),i+=1;break;case"reserved":"predicted"==p?o.setAttribute("class","predictedPortReserved"):o.setAttribute("class","portReserved"),a+=1;break;case"faulty":"predicted"==p?o.setAttribute("class","predictedPortFaulty"):o.setAttribute("class","portFaulty"),d+=1;break;case"predicted":"predicted"==p?o.setAttribute("class","predictedPortPredicted"):o.setAttribute("class","portPredicted"),c+=1}o.classList.add("cell"),n.appendChild(o);let r='<i class="fa fa-check"></i>';t.ports[e].errorCount>0&&t.ports[e].errorCount<100?r='<i class="fa fa fa-exclamation"></i>':t.ports[e].errorCount>=100&&(r='<i class="fa fa-times"></i> '),document.getElementById("port"+e).innerHTML=e+1+"<br>"+r}null==t?.decommissioned&&(t.decommissioned="");let u="<small><b>Host</b>:&emsp;"+t.host+"<br><center>( "+e+" )</center><br><br>Commissioned:&emsp;&emsp;"+t.commissioned+"<br>Decommissioned:&emsp;"+t.decommissioned+"<br>Source:&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"+p+"<br><br><b>Details</b>:<br>IP:&emsp;&emsp;"+t.mgmtIP+"<br>Vendor:&emsp;"+t.vendor+"<br>Model:&emsp;"+t.model+"<br>Image:&emsp;"+t.image+"<br>Version:&emsp;"+t.version+"<br><br><b>Location</b>:<br>Site:&emsp;"+t.siteId+"<br>Rack:&emsp;"+t.rackId+"<br>Slot(s):&emsp;"+t.slotPosition+"<br><br><b>Usage Summary:</b><br>Free:&emsp;&emsp;&emsp;"+l+"<br>Used:&emsp;&emsp;&emsp;"+i+"<br>Reserved:&emsp;"+a+"<br>Faulty:&emsp;&emsp;"+d+"<br>Predicted:&emsp;"+c+"<br>Error Count:&emsp;"+m+"<br><br><b>Common vulnerabilities and Exposures (CVE):</b><br>Known:&emsp;&emsp;"+cveKnown+"<br>Impacting:&emsp;"+cveImpacting+"</small>";document.getElementById("metadataPanel").innerHTML=u}})).catch((e=>{notify(e)}))}function fetchNePoints(){null!=frpReady&&clearTimeout(frpReady);let e=document.getElementById("neId");neId=e.options[e.selectedIndex].value,"-1"!=neId&&fetch(localStorage.getItem("mni.gatewayUrl")+"/ne/timeline/"+neId,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{neRawPoints=[];let t="<option disabled value='-1' selected='selected'> -- select a date/time -- </option>";for(var n=0;n<e.length;n++)t+="<option value='"+e[n].point+"' >"+e[n].point+"</option>",neRawPoints.push(e[n].point);document.getElementById("nePoint").innerHTML=t,neRawPoints.length>0?(document.getElementById("nePointRange").disabled=!1,document.getElementById("nePointRange").setAttribute("min",1),document.getElementById("nePointRange").setAttribute("max",neRawPoints.length),document.getElementById("nePointRange").setAttribute("value",neRawPoints.length),document.getElementById("nePoint").value=neRawPoints[neRawPoints.length-document.getElementById("nePointRange").value],fetchNe()):(document.getElementById("nePointRange").setAttribute("min",0),document.getElementById("nePointRange").setAttribute("max",0),document.getElementById("nePointRange").setAttribute("value",0),document.getElementById("nePointRange").disabled=!0)})).catch((e=>{notify(e)}))}try{countryListPopulate(),fetchListNe()}catch(e){notify(e)}