var map,polePath,lineSymbol;let poleId=null,point=null,mapVendor=null,poleX=0,poleY=0,marker=null,endMarker=null,mapCenter={lat:0,lng:0},mapRenderUrl=null;var trenchPanel=null,sitePanel=null;let trenchList="",siteList="";var tipObj=null;function injectTooltip(e,t){!tipObj&&e&&((tipObj=document.createElement("div")).setAttribute("class","mappolytooltip"),tipObj.innerHTML=t,document.body.appendChild(tipObj))}function deleteTooltip(e){tipObj&&(document.body.removeChild(tipObj),tipObj=null)}function injectTooltip(e,t){!tipObj&&e&&((tipObj=document.createElement("div")).setAttribute("class","mappolytooltip"),tipObj.innerHTML=t,document.body.appendChild(tipObj))}function deleteTooltip(e){tipObj&&(document.body.removeChild(tipObj),tipObj=null)}function fetchListPoles(){let e=document.getElementById("country"),t=e.options[e.selectedIndex].value;fetch(localStorage.getItem("mni.gatewayUrl")+"/pole?country="+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{let t=window.location.pathname.replace(localStorage.getItem("mni.rootUrl")+"/pole/",""),o="<option disabled value='-1' selected='selected'> -- select a pole -- </option>";null!=t&&(o="<option disabled value='-1'> -- select a pole -- </option>");for(var n=0;n<e.length;n++)t==e[n]?o+="<option value='"+e[n]+"' selected='selected'>"+e[n]+"</option>":o+="<option value='"+e[n]+"' >"+e[n]+"</option>";document.getElementById("poleId").innerHTML=o,document.getElementById("poleHeight").setAttribute("value",""),document.getElementById("poleClassifier").setAttribute("value",""),null!=t&&fetchPolePoints()})).catch((e=>{console.error(e)}))}function fetchPolePoints(){let e=document.getElementById("poleId");poleId=e.options[e.selectedIndex].value,"-1"!=poleId&&fetch(localStorage.getItem("mni.gatewayUrl")+"/pole/timeline/"+poleId,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{let t="<option disabled value='-1'> -- select a date/time point -- </option>";for(var o=0;o<e.length;o++)t+=0==o?"<option selected='selected' value='"+e[o].point+"' >"+e[o].point+"</option>":"<option value='"+e[o].point+"' >"+e[o].point+"</option>";document.getElementById("polePoint").innerHTML=t,fetchPole()})).catch((e=>{console.error(e)}))}function fetchMapRender(){fetch(localStorage.getItem("mni.gatewayUrl")+"/ui/mapRender",{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{null!=e.vendor&&(document.getElementById("mapVendor").innerHTML="<option value='"+e.vendor+"' selected='selected'>"+e.vendor+"</option>"),null!=e.url&&(mapRenderUrl=e.url+"&loading=async&callback=displayMap&v=weekly")})).catch((e=>{console.error(e)}))}function fetchPole(){let e=document.getElementById("poleId");poleId=e.options[e.selectedIndex].value;let t=document.getElementById("polePoint");point=t.options[t.selectedIndex].value,poleCoordinates=[],mapCenter={lat:0,lng:0},"-1"!=poleId&&"-1"!=point&&(fetch(localStorage.getItem("mni.gatewayUrl")+"/pole/"+poleId+"?point="+point,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{null!=e&&(poleX=e.coordinate.x,poleY=e.coordinate.y,trenchList=null!=e.connectsTo?.trenchId?'<li><a href="'+localStorage.getItem("mni.rootUrl")+"/trench/"+e.connectsTo?.trenchId+"?country="+mniSelectedCountry+'">'+e.connectsTo?.trenchId+"</a></li>":"<ul><li>none</li></ul>",siteList=null!=e.connectsTo?.siteId?'<li><a href="'+localStorage.getItem("mni.rootUrl")+"/site/"+e.connectsTo?.siteId+"?country="+mniSelectedCountry+'">'+e.connectsTo?.siteId+"</a></li>":"<ul><li>none</li></ul>",void 0!==document.getElementById("mapRender")&&null!=document.getElementById("mapRender")&&(map.setCenter({lat:poleY,lng:poleX}),null!=marker&&marker.setMap(null),marker.setPosition({lat:poleY,lng:poleX}),marker.setMap(map),google.maps.event.addListener(marker,"click",(function(e){(trenchPanel=new google.maps.InfoWindow({headerContent:"Trench",position:marker,content:trenchList})).open({shouldFocus:!0,map})})),google.maps.event.addListener(marker,"mouseover",(function(e){injectTooltip(e,poleId)})),google.maps.event.addListener(marker,"mouseout",(function(e){deleteTooltip(e)})),google.maps.event.addListener(marker,"rightclick",(function(e){(sitePanel=new google.maps.InfoWindow({headerContent:"Site",position:marker,content:siteList})).open({shouldFocus:!0,map})}))),null!=e.construction?.height&&null!=e.construction?.unit&&document.getElementById("poleHeight").setAttribute("value",e.construction.height+e.construction.unit),null!=e.construction?.classifier&&document.getElementById("poleClassifier").setAttribute("value",e.construction.classifier))})).catch((e=>{console.error(e)})),loadScript(mapRenderUrl,(function(){window.displayMap=function(){map=new google.maps.Map(document.getElementById("map"),{zoom:17,center:{lat:poleY,lng:poleX},mapTypeId:"hybrid",disableDefaultUI:!0}),marker=new google.maps.Marker({position:{lat:poleY,lng:poleX},label:{text:"îŸ®",fontFamily:"Material Symbols Outlined",color:"#ffffff",fontSize:"18px"},map}),google.maps.event.addListener(marker,"click",(function(e){(trenchPanel=new google.maps.InfoWindow({headerContent:"Trench",position:{lat:poleY,lng:poleX},content:trenchList})).open({shouldFocus:!0,map})})),google.maps.event.addListener(marker,"mouseover",(function(e){injectTooltip(e,poleId)})),google.maps.event.addListener(marker,"mouseout",(function(e){deleteTooltip(e)})),google.maps.event.addListener(marker,"rightclick",(function(e){(sitePanel=new google.maps.InfoWindow({headerContent:"Site",position:{lat:poleY,lng:poleX},content:siteList})).open({shouldFocus:!0,map})}))}})))}try{fetchMapRender(),countryListPopulate(fetchListPoles)}catch(e){console.error(e)}