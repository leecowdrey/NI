var map,polePath,lineSymbol;let fmrReady=null,ftgReady=null,fltReady=null,fppReady=null,retryMs=5e3,poleId=null,point=null,mapVendor=null,poleX=0,poleY=0,marker=null,endMarker=null,mapCenter={lat:0,lng:0},mapRenderUrl=null;function fetchListPoles(){null!=fltReady&&clearTimeout(fltReady);let e=document.getElementById("country"),t=e.options[e.selectedIndex].value;fetch(localStorage.getItem("mni.gatewayUrl")+"/pole?country="+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();fltReady=setTimeout(fetchMapRender,retryMs)})).then((e=>{let t="<option disabled value='-1' selected='selected'> -- select a pole -- </option>";for(var l=0;l<e.length;l++)t+="<option value='"+e[l]+"' >"+e[l]+"</option>";document.getElementById("poleId").innerHTML=t,document.getElementById("poleHeight").setAttribute("value",""),document.getElementById("poleClassifier").setAttribute("value","")})).catch((e=>{fltReady=setTimeout(fetchMapRender,retryMs)}))}function fetchPolePoints(){null!=fppReady&&clearTimeout(fppReady);let e=document.getElementById("poleId");poleId=e.options[e.selectedIndex].value,"-1"!=poleId&&fetch(localStorage.getItem("mni.gatewayUrl")+"/pole/timeline/"+poleId,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();fppReady=setTimeout(fetchMapRender,retryMs)})).then((e=>{let t="<option disabled value='-1' selected='selected'> -- select a date/time point -- </option>";for(var l=0;l<e.length;l++)t+="<option value='"+e[l].point+"' >"+e[l].point+"</option>";document.getElementById("polePoint").innerHTML=t})).catch((e=>{fppReady=setTimeout(fetchMapRender,retryMs)}))}function fetchMapRender(){null!=fmrReady&&clearTimeout(fmrReady),fetch(localStorage.getItem("mni.gatewayUrl")+"/ui/mapRender",{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();fmrReady=setTimeout(fetchMapRender,retryMs)})).then((e=>{null!=e.vendor&&(document.getElementById("mapVendor").innerHTML="<option value='"+e.vendor+"' selected='selected'>"+e.vendor+"</option>"),null!=e.url&&(mapRenderUrl=e.url+"&loading=async&callback=displayMap&v=weekly")})).catch((e=>{fmrReady=setTimeout(fetchMapRender,retryMs)}))}function fetchPole(){null!=ftgReady&&clearTimeout(ftgReady);let e=document.getElementById("poleId");poleId=e.options[e.selectedIndex].value;let t=document.getElementById("polePoint");point=t.options[t.selectedIndex].value,poleCoordinates=[],mapCenter={lat:0,lng:0},"-1"!=poleId&&"-1"!=point&&(fetch(localStorage.getItem("mni.gatewayUrl")+"/pole/"+poleId+"?point="+point,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();ftgReady=setTimeout(fetchPole,retryMs)})).then((e=>{null!=e&&(poleX=e.coordinate.x,poleY=e.coordinate.y,void 0!==document.getElementById("mapRender")&&null!=document.getElementById("mapRender")&&(map.setCenter({lat:poleY,lng:poleX}),null!=marker&&marker.setMap(null),marker.setPosition({lat:poleY,lng:poleX}),marker.setMap(map)),null!=e.construction?.height&&null!=e.construction?.unit&&document.getElementById("poleHeight").setAttribute("value",e.construction.height+e.construction.unit),null!=e.construction?.classifier&&document.getElementById("poleClassifier").setAttribute("value",e.construction.classifier))})).catch((e=>{ftgReady=setTimeout(fetchPole,retryMs)})),loadScript(mapRenderUrl,(function(){window.displayMap=function(){map=new google.maps.Map(document.getElementById("map"),{zoom:30,center:{lat:poleY,lng:poleX},mapTypeId:"hybrid",disableDefaultUI:!0}),marker=new google.maps.Marker({position:{lat:poleY,lng:poleX},icon:{path:"M 0,0 V15 M -4,4 H4",strokeOpacity:1,fillColor:"#8B0000",fillOpacity:1,strokeColor:"#8B0000",strokeWeight:6,scale:4},map})}})))}try{countryListPopulate(),fetchMapRender()}catch(e){fmrReady=setTimeout(fetchMapRender,retryMs)}try{fetchListPoles()}catch(e){fltReady=setTimeout(fetchListPoles,retryMs)}