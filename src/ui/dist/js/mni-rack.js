let flrReady=null,frpReady=null,frReady=null,retryMs=5e3,rackId=null,point=null;function fetchListRack(){null!=flrReady&&clearTimeout(flrReady),fetch(localStorage.getItem("mni.gatewayUrl")+"/rack",{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();flrReady=setTimeout(fetchListRack,retryMs)})).then((e=>{let t="<option disabled value='-1' selected='selected'> -- select a rack -- </option>";for(var s=0;s<e.length;s++)t+="<option value='"+e[s]+"' >"+e[s]+"</option>";document.getElementById("rackId").innerHTML=t})).catch((e=>{console.error(e),flrReady=setTimeout(fetchListRack,retryMs)}))}function fetchRack(){null!=frReady&&clearTimeout(flrReady);let e=document.getElementById("rackId");rackId=e.options[e.selectedIndex].value;let t=document.getElementById("rackPoint");point=t.options[t.selectedIndex].value;let s=document.querySelector(".grid");for(;s.firstChild;)s.removeChild(s.firstChild);fetch(localStorage.getItem("mni.gatewayUrl")+"/rack/"+rackId+"?point="+point,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();flrReady=setTimeout(fetchRack,retryMs)})).then((e=>{let t=e.slots,r=0,o=0,l=0,a=0,c=0,i=e.slotUsage.reverse(),d="historical";null!=e.source&&(d=e.source),s.style.setProperty("--max-rack-slots",t);for(let e=0;e<i.length;e++){let n=document.createElement("div");switch(n.setAttribute("id","slot"+(t-e)),i[e].usage){case"free":n.setAttribute("title",t-e+": "+i[e].usage),"predicted"==d?n.setAttribute("class","predictedSlotFree"):n.setAttribute("class","slotFree"),o+=1;break;case"used":n.setAttribute("title",t-e+": "+i[e].usage+" "+i[e].host),"predicted"==d?n.setAttribute("class","predictedSlotUsed"):n.setAttribute("class","slotUsed"),r+=1;break;case"reserved":n.setAttribute("title",t-e+": "+i[e].usage),"predicted"==d?n.setAttribute("class","predictedSlotReserved"):n.setAttribute("class","slotReserved"),l+=1;break;case"faulty":n.setAttribute("title",t-e+": "+i[e].usage),"predicted"==d?n.setAttribute("class","predictedSlotFaulty"):n.setAttribute("class","slotFaulty"),a+=1;break;case"predicted":n.setAttribute("title",t-e+": "+i[e].usage),"predicted"==d?n.setAttribute("class","predictedSlotPredicted"):n.setAttribute("class","slotPredicted"),c+=1}n.classList.add("cell"),s.appendChild(n);let m="";m="used"===i[e].usage&&null!=i[e].neId?"&emsp;"+(t-e)+' <a href="<%=payload.rootUrl%>/ne/'+i[e].neId+'" target="_self">+</a>&emsp;'+i[e].host:"&emsp;"+(t-e),document.getElementById("slot"+(t-e)).innerHTML=m}null==e?.decommissioned&&(e.decommissioned="");let n="<small><b>Reference</b>:&emsp;"+e.reference+"<br><center>( "+rackId+" )</center><br><br>Commissioned:&emsp;&emsp;"+e.commissioned+"<br>Decommissioned:&emsp;"+e.decommissioned+"<br>Source:&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"+d+"<br><br><b>Dimensions</b>:<br>H/W/D:&emsp;"+e.dimensions.height+" / "+e.dimensions.width+" / "+e.dimensions.depth+" "+e.dimensions.unit+"<br>Slots:&emsp;&emsp;"+e.slots+"<br><br><b>Location</b>:<br>X,Y,Z:&emsp;&emsp;"+e.coordinate.x+" , "+e.coordinate.y+" , "+e.coordinate.z+"<br>Area:&emsp;&emsp;"+e.area+"<br>Floor:&emsp;&emsp;"+e.floor+"<br>Row:&emsp;&emsp;"+e.row+"<br><br><b>Usage Summary:</b><br>Free:&emsp;&emsp;&emsp;&emsp;"+o+"<br>Used:&emsp;&emsp;&emsp;&emsp;"+r+"<br>Reserved:&emsp;&emsp;"+l+"<br>Faulty:&emsp;&emsp;&emsp;"+a+"<br>Predicted:&emsp;&emsp;"+c+"</small>";document.getElementById("metadataPanel").innerHTML=n})).catch((e=>{console.error(e),frReady=setTimeout(fetchRack,retryMs)}))}function fetchRackPoints(){null!=frpReady&&clearTimeout(frpReady);let e=document.getElementById("rackId");rackId=e.options[e.selectedIndex].value,"-1"!=rackId&&fetch(localStorage.getItem("mni.gatewayUrl")+"/rack/timeline/"+rackId,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();frpReady=setTimeout(fetchRackPoints,retryMs)})).then((e=>{let t="<option disabled value='-1' selected='selected'> -- select a date/time -- </option>";for(var s=0;s<e.length;s++)t+="<option value='"+e[s].point+"' >"+e[s].point+"</option>";document.getElementById("rackPoint").innerHTML=t})).catch((e=>{console.error(e),frpReady=setTimeout(fetchRackPoints,retryMs)}))}try{fetchListRack()}catch(e){console.error(e),flrReady=setTimeout(fetchListRack,retryMs)}