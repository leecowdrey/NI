let flrReady=null,frpReady=null,frReady=null,retryMs=5e3,rackId=null,point=null;function fetchListRack(){null!=flrReady&&clearTimeout(flrReady);let e=document.getElementById("country"),t=e.options[e.selectedIndex].value;fetch(localStorage.getItem("mni.gatewayUrl")+"/rack?country="+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{let t="<option disabled value='-1' selected='selected'> -- select a rack -- </option>";for(var s=0;s<e.length;s++)t+="<option value='"+e[s]+"' >"+e[s]+"</option>";document.getElementById("rackId").innerHTML=t})).catch((e=>{notify(e)}))}function fetchRack(){null!=frReady&&clearTimeout(flrReady);let e=document.getElementById("rackId");rackId=e.options[e.selectedIndex].value;let t=document.getElementById("rackPoint");point=t.options[t.selectedIndex].value;let s=document.querySelector(".grid");for(;s.firstChild;)s.removeChild(s.firstChild);fetch(localStorage.getItem("mni.gatewayUrl")+"/rack/"+rackId+"?point="+point,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{let t=e.slots,r=0,l=0,o=0,i=0,a=0,n=e.slotUsage.reverse(),d="historical";null!=e.source&&(d=e.source),s.style.setProperty("--max-rack-slots",t);for(let e=0;e<n.length;e++){let c=document.createElement("div");switch(c.setAttribute("id","slot"+(t-e)),n[e].usage){case"free":c.setAttribute("title",t-e+": "+n[e].usage),"predicted"==d?c.setAttribute("class","predictedSlotFree"):c.setAttribute("class","slotFree"),l+=1;break;case"used":c.setAttribute("title",t-e+": "+n[e].usage+" "+n[e].host),"predicted"==d?c.setAttribute("class","predictedSlotUsed"):c.setAttribute("class","slotUsed"),r+=1;break;case"reserved":c.setAttribute("title",t-e+": "+n[e].usage),"predicted"==d?c.setAttribute("class","predictedSlotReserved"):c.setAttribute("class","slotReserved"),o+=1;break;case"faulty":c.setAttribute("title",t-e+": "+n[e].usage),"predicted"==d?c.setAttribute("class","predictedSlotFaulty"):c.setAttribute("class","slotFaulty"),i+=1;break;case"predicted":c.setAttribute("title",t-e+": "+n[e].usage),"predicted"==d?c.setAttribute("class","predictedSlotPredicted"):c.setAttribute("class","slotPredicted"),a+=1}c.classList.add("cell"),s.appendChild(c);let m="";m="used"===n[e].usage&&null!=n[e].neId?"&emsp;"+(t-e)+' <a href="<%=payload.rootUrl%>/ne/'+n[e].neId+'" target="_self">+</a>&emsp;'+n[e].host:"&emsp;"+(t-e),document.getElementById("slot"+(t-e)).innerHTML=m}null==e?.decommissioned&&(e.decommissioned="");let c="<small><b>Reference</b>:&emsp;"+e.reference+"<br><center>( "+rackId+" )</center><br><br>Commissioned:&emsp;&emsp;"+e.commissioned+"<br>Decommissioned:&emsp;"+e.decommissioned+"<br>Source:&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"+d+"<br><br><b>Dimensions</b>:<br>H/W/D:&emsp;"+e.dimensions.height+" / "+e.dimensions.width+" / "+e.dimensions.depth+" "+e.dimensions.unit+"<br>Slots:&emsp;&emsp;"+e.slots+"<br><br><b>Location</b>:<br>X,Y,Z:&emsp;&emsp;"+e.coordinate.x+" , "+e.coordinate.y+" , "+e.coordinate.z+"<br>Area:&emsp;&emsp;"+e.area+"<br>Floor:&emsp;&emsp;"+e.floor+"<br>Row:&emsp;&emsp;"+e.row+"<br><br><b>Usage Summary:</b><br>Free:&emsp;&emsp;&emsp;&emsp;"+l+"<br>Used:&emsp;&emsp;&emsp;&emsp;"+r+"<br>Reserved:&emsp;&emsp;"+o+"<br>Faulty:&emsp;&emsp;&emsp;"+i+"<br>Predicted:&emsp;&emsp;"+a+"</small>";document.getElementById("metadataPanel").innerHTML=c})).catch((e=>{notify(e)}))}function fetchRackPoints(){null!=frpReady&&clearTimeout(frpReady);let e=document.getElementById("rackId");rackId=e.options[e.selectedIndex].value,"-1"!=rackId&&fetch(localStorage.getItem("mni.gatewayUrl")+"/rack/timeline/"+rackId,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{let t="<option disabled value='-1' selected='selected'> -- select a date/time -- </option>";for(var s=0;s<e.length;s++)t+="<option value='"+e[s].point+"' >"+e[s].point+"</option>";document.getElementById("rackPoint").innerHTML=t})).catch((e=>{notify(e)}))}try{countryListPopulate(),fetchListRack()}catch(e){notify(e)}