var map,polePath,lineSymbol;let siteId=null,point=null,mapVendor=null,siteX=0,siteY=0,marker=null,endMarker=null,mapCenter={lat:0,lng:0},mapRenderUrl=null,urlOnOffNetSuffix="";var trenchPanel=null,polePanel=null;let trenchList="",poleList="";var tipObj=null;function injectTooltip(e,t){!tipObj&&e&&((tipObj=document.createElement("div")).setAttribute("class","mappolytooltip"),tipObj.innerHTML=t,document.body.appendChild(tipObj))}function deleteTooltip(e){tipObj&&(document.body.removeChild(tipObj),tipObj=null)}function fetchListSites(){let e=document.getElementById("country"),t=e.options[e.selectedIndex].value;urlOnOffNetSuffix=document.getElementById("onNet").checked?"onnet?country="+t:"offnet?country="+t,fetch(localStorage.getItem("mni.gatewayUrl")+"/site/"+urlOnOffNetSuffix,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{let t=window.location.pathname.replace(localStorage.getItem("mni.rootUrl")+"/site/",""),n="<option disabled value='-1' selected='selected'> -- select a site -- </option>";null!=t&&(n="<option disabled value='-1'> -- select a site -- </option>");for(var o=0;o<e.length;o++)t==e[o]?n+="<option value='"+e[o].siteId+"' selected='selected'>"+e[o].reference+"</option>":n+="<option value='"+e[o].siteId+"' >"+e[o].reference+"</option>";document.getElementById("siteId").innerHTML=n,document.getElementById("siteArea").setAttribute("value",""),document.getElementById("siteType").setAttribute("value",""),null!=t&&fetchSite()})).catch((e=>{console.error(e)}))}function fetchMapRender(){fetch(localStorage.getItem("mni.gatewayUrl")+"/ui/mapRender",{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{null!=e.vendor&&(document.getElementById("mapVendor").innerHTML="<option value='"+e.vendor+"' selected='selected'>"+e.vendor+"</option>"),null!=e.url&&(mapRenderUrl=e.url+"&loading=async&callback=displayMap&v=weekly")})).catch((e=>{console.error(e)}))}function fetchSite(){let e=document.getElementById("siteId");siteId=e.options[e.selectedIndex].value,poleCoordinates=[],mapCenter={lat:0,lng:0},"-1"!=siteId&&"-1"!=point&&(fetch(localStorage.getItem("mni.gatewayUrl")+"/site/"+siteId,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{if(null!=e){if(siteX=e.location.coordinate.x,siteY=e.location.coordinate.y,null!=e.trench){trenchList="<ul>";for(let t=0;t<e.trench.length;t++)trenchList+='<li><a href="'+localStorage.getItem("mni.rootUrl")+"/trench/"+e.trench[t]+"?country="+mniSelectedCountry+'">'+e.trench[t]+"</a></li>";trenchList+="</ul>"}if(null!=e.pole){poleList="<ul>";for(let t=0;t<e.pole.length;t++)poleList+='<li><a href="'+localStorage.getItem("mni.rootUrl")+"/pole/"+e.pole[t]+"?country="+mniSelectedCountry+'">'+e.pole[t]+"</a></li>";poleList+="</ul>"}void 0!==document.getElementById("mapRender")&&null!=document.getElementById("mapRender")&&(map.setCenter({lat:siteY,lng:siteX}),null!=marker&&marker.setMap(null),marker.setPosition({lat:siteY,lng:siteX}),marker.setMap(map),document.getElementById("onNet").checked&&(google.maps.event.addListener(marker,"click",(function(e){(trenchPanel=new google.maps.InfoWindow({headerContent:"Trenches",position:{lat:siteY,lng:siteX},content:trenchList})).open({shouldFocus:!0,map})})),google.maps.event.addListener(marker,"mouseover",(function(e){injectTooltip(e,siteId)})),google.maps.event.addListener(marker,"mouseout",(function(e){deleteTooltip(e)})),google.maps.event.addListener(marker,"rightclick",(function(e){(polePanel=new google.maps.InfoWindow({headerContent:"Poles",position:{lat:siteY,lng:siteX},content:poleList})).open({shouldFocus:!0,map})})))),null!=e.area&&document.getElementById("siteArea").setAttribute("value",e.area),null!=e.type&&document.getElementById("siteType").setAttribute("value",e.type)}})).catch((e=>{console.error(e)})),loadScript(mapRenderUrl,(function(){window.displayMap=function(){map=new google.maps.Map(document.getElementById("map"),{zoom:17,center:{lat:siteY,lng:siteX},mapTypeId:"hybrid",disableDefaultUI:!0}),marker=new google.maps.Marker({position:{lat:siteY,lng:siteX},label:{text:"îŸ®",fontFamily:"Material Symbols Outlined",color:"#ffffff",fontSize:"18px"},map}),google.maps.event.addListener(marker,"mouseover",(function(e){injectTooltip(e,siteId)})),google.maps.event.addListener(marker,"mouseout",(function(e){deleteTooltip(e)})),google.maps.event.addListener(marker,"click",(function(e){(trenchPanel=new google.maps.InfoWindow({headerContent:"Trenches",position:{lat:siteY,lng:siteX},content:trenchList})).open({shouldFocus:!0,map})})),google.maps.event.addListener(marker,"rightclick",(function(e){(polePanel=new google.maps.InfoWindow({headerContent:"Poles",position:{lat:siteY,lng:siteX},content:poleList})).open({shouldFocus:!0,map})}))}})))}try{fetchMapRender(),countryListPopulate(fetchListSites)}catch(e){console.error(e)}