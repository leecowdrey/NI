var map,trenchPath,lineSymbol;let fmrReady=null,ftgReady=null,fltReady=null,ftpReady=null,ftdReady=null,ftppReady=null,retryMs=5e3,trenchId=null,point=null,mapVendor=null,trenchCoordinates=[],startMarker=null,endMarker=null,mapCenter={lat:0,lng:0},mapRenderUrl=null;function fetchTrenchPremisesPassed(e,t){null!=ftppReady&&clearTimeout(ftppReady),fetch(localStorage.getItem("mni.gatewayUrl")+"/trench/premisesPassed/"+e+"?point="+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((t=>{if(t.ok)return t.json();ftppReady=setTimeout(fetchTrenchPremisesPassed,retryMs,e)})).then((e=>{null!=e&&null!=e.passed&&document.getElementById("trenchPremisesPassed").setAttribute("value",e.passed)})).catch((n=>{ftppReady=setTimeout(fetchTrenchPremisesPassed,retryMs,e,t)}))}function fetchTrenchDistance(e,t){null!=ftdReady&&clearTimeout(ftdReady),fetch(localStorage.getItem("mni.gatewayUrl")+"/trench/distance/"+e+"?point="+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((n=>{if(n.ok)return n.json();ftdReady=setTimeout(fetchTrenchDistance,retryMs,e,t)})).then((e=>{null!=e&&null!=e.distance&&null!=e.unit&&document.getElementById("trenchDistance").setAttribute("value",e.distance+e.unit)})).catch((n=>{ftdReady=setTimeout(fetchTrenchDistance,retryMs,e,t)}))}function fetchListTrench(){null!=fltReady&&clearTimeout(fltReady);let e=document.getElementById("country"),t=e.options[e.selectedIndex].value;fetch(localStorage.getItem("mni.gatewayUrl")+"/trench?country="+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();fltReady=setTimeout(fetchListTrench,retryMs)})).then((e=>{let t="<option disabled value='-1' selected='selected'> -- select a trench -- </option>";for(var n=0;n<e.length;n++)t+="<option value='"+e[n]+"' >"+e[n]+"</option>";document.getElementById("trenchId").innerHTML=t,document.getElementById("trenchDistance").setAttribute("value","")})).catch((e=>{fltReady=setTimeout(fetchListTrench,retryMs)}))}function fetchTrenchPoints(){null!=ftpReady&&clearTimeout(ftpReady);let e=document.getElementById("trenchId");trenchId=e.options[e.selectedIndex].value,"-1"!=trenchId&&fetch(localStorage.getItem("mni.gatewayUrl")+"/trench/timeline/"+trenchId,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();ftpReady=setTimeout(fetchTrenchPoints,retryMs)})).then((e=>{let t="<option disabled value='-1' selected='selected'> -- select a date/time -- </option>";for(var n=0;n<e.length;n++)t+="<option value='"+e[n].point+"' >"+e[n].point+"</option>";document.getElementById("trenchPoint").innerHTML=t})).catch((e=>{ftpReady=setTimeout(fetchTrenchPoints,retryMs)}))}function fetchMapRender(){null!=fmrReady&&clearTimeout(fmrReady),fetch(localStorage.getItem("mni.gatewayUrl")+"/ui/mapRender",{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();fmrReady=setTimeout(fetchMapRender,retryMs)})).then((e=>{null!=e.vendor&&(document.getElementById("mapVendor").innerHTML="<option value='"+e.vendor+"' selected='selected'>"+e.vendor+"</option>"),null!=e.url&&(mapRenderUrl=e.url+"&loading=async&callback=displayMap&v=weekly")})).catch((e=>{fmrReady=setTimeout(fetchMapRender,retryMs)}))}function fetchTrenchGeometry(){null!=ftgReady&&clearTimeout(ftgReady);let e=document.getElementById("trenchId");trenchId=e.options[e.selectedIndex].value;let t=document.getElementById("trenchPoint");point=t.options[t.selectedIndex].value,trenchCoordinates=[],mapCenter={lat:0,lng:0},fetch(localStorage.getItem("mni.gatewayUrl")+"/trench/geometry/"+trenchId+"?point="+point,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json();ftgReady=setTimeout(fetchTrenchGeometry,retryMs)})).then((e=>{if(null!=e){if(e.length>0){let t=Number.parseFloat(e.length/2).toFixed(0);mapCenter={lat:e[t].y,lng:e[t].x}}else mapCenter={lat:0,lng:0};for(var t=0;t<e.length;t++){let n={lat:e[t].y,lng:e[t].x};trenchCoordinates.push(n)}void 0!==document.getElementById("mapRender")&&null!=document.getElementById("mapRender")&&(map.setCenter(mapCenter),trenchPath.setMap(null),trenchPath.setPath(trenchCoordinates),trenchPath.setMap(map),null!=startMarker&&startMarker.setMap(null),null!=endMarker&&endMarker.setMap(null),trenchCoordinates.length>0&&(startMarker.setPosition({lat:trenchCoordinates[0].lat,lng:trenchCoordinates[0].lng}),startMarker.setMap(map),endMarker.setPosition({lat:trenchCoordinates[trenchCoordinates.length-1].lat,lng:trenchCoordinates[trenchCoordinates.length-1].lng}),endMarker.setMap(map)))}fetchTrenchDistance(trenchId,point),fetchTrenchPremisesPassed(trenchId,point)})).catch((e=>{ftgReady=setTimeout(fetchTrenchGeometry,retryMs)})),loadScript(mapRenderUrl,(function(){window.displayMap=function(){map=new google.maps.Map(document.getElementById("map"),{zoom:17,center:mapCenter,mapTypeId:"hybrid",disableDefaultUI:!0}),lineSymbol={path:"M 0,-1 0,1",strokeOpacity:1,scale:4},(trenchPath=new google.maps.Polyline({path:trenchCoordinates,strokeOpacity:1,strokeColor:"#8B0000",strokeWeight:4,icons:[{icon:lineSymbol,offset:"0",repeat:"20px"}],map})).setMap(map),startMarker=new google.maps.Marker({position:trenchCoordinates[0],icon:{path:google.maps.SymbolPath.CIRCLE,scale:6,strokeOpacity:0,strokeColor:"#8B0000",fillOpacity:1,fillColor:"#8B0000"},map}),endMarker=new google.maps.Marker({position:trenchCoordinates[trenchCoordinates.length-1],icon:{path:google.maps.SymbolPath.CIRCLE,scale:6,strokeOpacity:0,strokeColor:"#8B0000",fillOpacity:1,fillColor:"#8B0000"},map})}}))}try{countryListPopulate(),fetchMapRender()}catch(e){fmrReady=setTimeout(fetchMapRender,retryMs)}try{fetchListTrench()}catch(e){fltReady=setTimeout(fetchListTrench,retryMs)}