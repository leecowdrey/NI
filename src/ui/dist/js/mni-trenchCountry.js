var lineSymbol,tPath=[],tPoly=[];let fmrReady=null,ftgReady=null,fltReady=null,fltcReady=null,ftpReady=null,ftdReady=null,ftppReady=null,retryMs=5e3,trenchId=null,mapVendor=null,trenches=[],trenchCoordinates={},trenchColor="#8B0000",trenchOpacity=1,mapCenter={lat:0,lng:0},mapRenderUrl=null;function clp(){let e=localStorage.getItem("mni.country");fetch(localStorage.getItem("mni.gatewayUrl")+"/ui/countries",{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((t=>{if(t.length>0){t.sort();let e="<option disabled value='-1' selected='selected'> -- select a country -- </option>";for(let n=0;n<t.length;n++)e+="<option value='"+t[n]+"'>"+t[n]+"</option>";document.getElementById("country").innerHTML=e}else document.getElementById("country").innerHTML="<option value='"+e+"' selected='selected'>"+e+"</option>"})).catch((e=>{notify(e)}))}function fetchTrenchCountry(){try{null!=fltcReady&&clearTimeout(fltcReady),trenchCoordinates={},trenches=[];let e=document.getElementById("country"),t=e.options[e.selectedIndex].value;mapCenter={lat:0,lng:0},fetch(localStorage.getItem("mni.gatewayUrl")+"/trench/geometry/country?country="+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{null!=e&&(null!=e.centroid&&(mapCenter={lat:e.centroid.y,lng:e.centroid.x}),null!=e.passed&&document.getElementById("trenchPremisesPassed").setAttribute("value",e.passed),null!=e.distance&&null!=e.unit&&document.getElementById("trenchDistance").setAttribute("value",e.distance+e.unit),trenchCoordinates=JSON.parse(JSON.stringify(e)),trenches=trenchCoordinates.trenches,void 0!==document.getElementById("mapRender")&&null!=document.getElementById("mapRender")&&(map.setCenter(mapCenter),drawOnMap()),loadScript(mapRenderUrl,(function(){window.displayMap=function(){map=new google.maps.Map(document.getElementById("map"),{zoom:6,center:mapCenter,mapTypeId:"terrain",disableDefaultUI:!0}),lineSymbol={path:"M 0,-1 0,1",strokeOpacity:1,scale:4},map.setCenter(mapCenter),drawOnMap()}})))})).catch((e=>{notify(e)}))}catch(e){console.error(e)}}function drawOnMap(){try{if(Object.keys(tPoly).length>0){for(let e in tPoly)tPoly[e].setMap(null),tPoly[e]=null;tPoly=[],tPath=[]}if(null!=trenchCoordinates&&null!=trenches)for(let e=0;e<trenches.length;e++){let t=trenches[e];tPath[t]=[],tPoly[t]=[];for(let e=0;e<trenchCoordinates[t].length;e++)tPath[t].push({lat:trenchCoordinates[t][e].y,lng:trenchCoordinates[t][e].x});tPoly[t]=new google.maps.Polyline({path:tPath[t],strokeOpacity:trenchOpacity,strokeColor:trenchColor,strokeWeight:4,icons:[{icon:lineSymbol,offset:"0",repeat:"20px"}],map,title:t}),tPoly[t].setMap(map)}}catch(e){console.error(e)}}function fetchMapRender(){null!=fmrReady&&clearTimeout(fmrReady),fetch(localStorage.getItem("mni.gatewayUrl")+"/ui/mapRender",{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{null!=e.vendor&&(document.getElementById("mapVendor").innerHTML="<option value='"+e.vendor+"' selected='selected'>"+e.vendor+"</option>"),null!=e.url&&(mapRenderUrl=e.url+"&loading=async&callback=displayMap&v=weekly")})).catch((e=>{notify(e)}))}try{clp(),fetchMapRender()}catch(e){notify(e)}