var mniLicenseHost=null,mniLicenseDomain=null,mniLicenseStart=null,mniLicenseExpiry=null,mniAppShortName="MNI",mniAppIcon="/favicon.ico",mniAppNotificationIcon="/favicon.ico",mniAppName=null,mniAppVersion=null,mniAppBuild=null,mniCountryCode="BEL",mniCurrencyName="Euro",mniCurrencyIsoCode="EUR",mniCurrencySymbol="â‚¬",mniSelectedCountry=null,mniRootUrl="/mni",mniGatewayUrl=null,mniGatewayUrlIp=null,mniGatewayUrlDns=null,mniRetryMs=1e3,mniRefreshMs=6e4,mniReadinessAttempts=10,mniOAuthRefresh=null;const countryCode=["ABW","AFG","AGO","AIA","ALB","AND","ARE","ARG","ARM","ASM","ATA","ATF","ATG","AUS","AUT","AZE","BDI","BEL","BEN","BES","BFA","BGD","BGR","BHR","BHS","BIH","BLM","BLR","BLZ","BMU","BOL","BRA","BRB","BRN","BTN","BWA","CAF","CAN","CHE","CHL","CHN","CIV","CMR","COD","COG","COK","COL","COM","CPV","CRI","CUB","CUW","CYM","CYP","CZE","DEU","DJI","DMA","DNK","DOM","DZA","ECU","EGY","ERI","ESP","EST","ETH","FIN","FJI","FLK","FRA","FRO","FSM","GAB","GBR","GEO","GGY","GHA","GIB","GIN","GLP","GMB","GNB","GNQ","GRC","GRD","GRL","GTM","GUF","GUM","GUY","HND","HRV","HTI","HUN","IDN","IMN","IND","IRL","IRN","IRQ","ISL","ISR","ITA","JAM","JOR","JPN","KAZ","KEN","KGZ","KHM","KIR","KNA","KOR","KWT","LAO","LBN","LBR","LBY","LCA","LIE","LKA","LSO","LTU","LUX","LVA","MAR","MCO","MDA","MDG","MDV","MEX","MHL","MKD","MLI","MLT","MMR","MNE","MNG","MNP","MOZ","MRT","MSR","MTQ","MUS","MWI","MYS","MYT","NAM","NCL","NER","NGA","NIC","NIU","NLD","NOR","NPL","NRU","NZL","OMN","PAK","PAN","PCN","PER","PHL","PLW","PNG","POL","PRK","PRT","PRY","PSE","PYF","QAT","REU","ROU","RUS","RWA","SAU","SDN","SEN","SGP","SHN","SLB","SLE","SLV","SMR","SOM","SRB","SSD","STP","SUR","SVK","SVN","SWE","SWZ","SYC","SYR","TCA","TCD","TGO","THA","TJK","TKL","TKM","TLS","TON","TTO","TUN","TUR","TUV","TWN","TZA","UGA","UKR","URY","USA","UZB","VAT","VCT","VEN","VGB","VIR","VNM","VUT","WLF","WSM","YEM","ZAF","ZMB","ZWE"];function toBoolean(e){return"true"===String(e).toLowerCase()}function toPercent(e,t){let o=0;try{return t>0&&(o=Number.parseFloat(e/t*100).toFixed(0)),o}catch(e){return 0}}function toInteger(e){return Number.isNaN(Number.parseInt(e,10))?0:Number.parseInt(e,10)}function mniMetadata(){try{fetch("/mni/metadata",{method:"GET",headers:{Accept:"application/json"}}).then((e=>{if(e.ok)return e.json()})).then((e=>{localStorage.setItem("mni.appName",e.name),localStorage.setItem("mni.appShortName",e.shortName),localStorage.setItem("mni.appIcon",e.icon),localStorage.setItem("mni.appNotificationIcon",e.notificatonIcon),localStorage.setItem("mni.appVersion",e.version),localStorage.setItem("mni.appBuild",e.build),localStorage.setItem("mni.country",e.country),localStorage.setItem("mni.selectedCountry",e.country),localStorage.setItem("mni.currencyName",e.currencyName),localStorage.setItem("mni.currencyIsoCode",e.currencyIsoCode),localStorage.setItem("mni.currencySymbol",e.currencySymbol),localStorage.setItem("mni.rootUrl",e.rootUrl),localStorage.setItem("mni.gatewayUrl",e.gatewayUrl),localStorage.setItem("mni.gatewayUrlIp",e.gatewayUrlIp),localStorage.setItem("mni.gatewayUrlDns",e.gatewayUrlDns),localStorage.setItem("mni.retryMs",e.retryMs),localStorage.setItem("mni.refreshMs",e.refreshMs),localStorage.setItem("mni.readinessAttempts",e.readinessAttempts),localStorage.setItem("mni.",!0)})).catch((e=>{console.error(e)})),mniAppName=localStorage.getItem("mni.appName"),mniAppShortName=localStorage.getItem("mni.appShortName"),mniAppIcon=localStorage.getItem("mni.appIcon"),mniAppNotificationIcon=localStorage.getItem("mni.appNotificationIcon"),mniAppVersion=localStorage.getItem("mni.appVersion"),mniAppBuild=localStorage.getItem("mni.appBuild"),mniCountryCode=localStorage.getItem("mni.country"),mniCurrencyName=localStorage.getItem("mni.currencyName"),mniCurrencyIsoCode=localStorage.getItem("mni.currencyIsoCode"),mniCurrencySymbol=localStorage.getItem("mni.currencySymbol"),mniRootUrl=localStorage.getItem("mni.rootUrl"),mniGatewayUrl=localStorage.getItem("mni.gatewayUrl"),mniGatewayUrlIp=localStorage.getItem("mni.gatewayUrlIp"),mniGatewayUrlDns=localStorage.getItem("mni.gatewayUrlDns"),mniRetryMs=localStorage.getItem("mni.retryMs"),mniRefreshMs=localStorage.getItem("mni.refreshMs"),mniReadinessAttempts=localStorage.getItem("mni.readinessAttempts"),mniSelectedCountry=localStorage.getItem("mni.selectedCountry")}catch(e){console.error(e)}}function mniLicense(){try{fetch(localStorage.getItem("mni.gatewayUrl")+"/license",{method:"GET",headers:{Accept:"application/json"}}).then((e=>{if(e.ok)return e.json()})).then((e=>{localStorage.setItem("mni.license.host",e.host),localStorage.setItem("mni.license.domain",e.domain),localStorage.setItem("mni.license.start",e.start),localStorage.setItem("mni.license.expiry",e.expiry),localStorage.setItem("mni.license.",!0)})).catch((e=>{console.error(e)})),mniLicenseHost=localStorage.getItem("mni.license.host"),mniLicenseDomain=localStorage.getItem("mni.license.domain"),mniLicenseStart=localStorage.getItem("mni.license.start"),mniLicenseExpiry=localStorage.getItem("mni.license.expiry")}catch(e){console.error(e)}}function mniLoadScript(e,t){let o=document.head,n=document.createElement("script");n.type="text/javascript",n.src=e,n.onreadystatechange=t,n.onload=t,o.appendChild(n)}function clearSessionStorage(){let e=localStorage.length;for(var t=0;t<e;t++)null!=localStorage.key(t)&&localStorage.key(t).startsWith("mni.")&&localStorage.removeItem(localStorage.key(t))}function dumpSessionStorage(){let e=localStorage.length;for(var t=0;t<e;t++)null!=localStorage.key(t)&&localStorage.key(t).startsWith("mni.")&&console.log(localStorage.key(t)+"="+localStorage.getItem(localStorage.key(t)))}function notify(e,t="MNI",o="/favicon.ico"){"Notification"in window?"granted"===Notification.permission?new Notification(t,{body:e,icon:o}):"denied"!==Notification.permission&&Notification.requestPermission().then((e=>{"granted"===e&&new Notification("Permission request",{body:"Requesting permission to send notifications while using MNI",icon:"/favicon.ico"})})):console.log("Browser does not support notifications.")}function jump(e){return window.location=e,!1}function menuJump(e){return jump(localStorage.getItem("mni.rootUrl")+"/"+e),!1}function tokenRefresh(){if(toBoolean(localStorage.getItem("mni.auth.oauth"))){null!=mniOAuthRefresh&&clearTimeout(mniOAuthRefresh);let e=new URLSearchParams({client_id:clientId,grant_type:"refresh_token",scope:localStorage.getItem("mni.auth.scope"),refresh_token:localStorage.getItem("mni.auth.refreshToken")});fetch(localStorage.getItem("mni.rootUrl")+"/login/refresh",{method:"POST",headers:{Accept:"application/json"},body:e,keepalive:!0}).then((e=>{if(e.ok){if(200==e.status&&toInteger(e.headers.get("Content-Length"))>0)return e.json()}else 401==e.status&&(window.alert("Authorization time-out"),window.location.replace("/"))})).then((async e=>{null!=e&&(localStorage.setItem("mni.auth.accessToken",e.access_token),localStorage.setItem("mni.auth.expiresIn",e.expires_in),localStorage.setItem("mni.auth.refreshExpiresIn",e.refresh_expires_in),localStorage.setItem("mni.auth.refreshToken",e.refresh_token),mniOAuthRefresh=setTimeout(tokenRefresh,1e3*localStorage.getItem("mni.auth.refreshExpiresIn")))})).catch((e=>{console.error(e)}))}}function login(e,t,o=!1){if(null!=e&&null!=t)if(o){localStorage.setItem("mni.auth.oauth",!0);let o=new URLSearchParams({username:e,password:t});fetch(localStorage.getItem("mni.rootUrl")+"/login",{method:"POST",headers:{Accept:"application/json"},body:o,keepalive:!0}).then((e=>{if(e.ok){if(200==e.status&&toInteger(e.headers.get("Content-Length"))>0)return e.json()}else 400==e.status?(window.alert("Bad request"),window.location.replace("/")):401==e.status?(window.alert("Authorization failed\nInvalid or unknown username or password"),window.location.replace("/")):console.error(e.status,e.statusText)})).then((async e=>{null!=e&&(localStorage.setItem("mni.auth.idToken",e.id_token),localStorage.setItem("mni.auth.accessToken",e.access_token),localStorage.setItem("mni.auth.expiresIn",e.expires_in),localStorage.setItem("mni.auth.refreshExpiresIn",e.refresh_expires_in),localStorage.setItem("mni.auth.refreshToken",e.refresh_token),localStorage.setItem("mni.auth.sessionState",e.session_state),localStorage.setItem("mni.auth.tokenType",e.token_type),localStorage.setItem("mni.auth.scope",e.scope),mniOAuthRefresh=setTimeout(tokenRefresh,1e3*localStorage.getItem("mni.auth.refreshExpiresIn")),window.location.replace(localStorage.getItem("mni.rootUrl")+"/readiness"))})).catch((e=>{console.error(e)}))}else localStorage.setItem("mni.auth.oauth",!1),res.sendStatus(401);else window.location.replace("/")}function logout(){if(null!=mniOAuthRefresh&&clearTimeout(mniOAuthRefresh),toBoolean(localStorage.getItem("mni.auth.oauth"))){let e=new URLSearchParams({access_token:localStorage.getItem("mni.auth.accessToken"),refresh_token:localStorage.getItem("mni.auth.refreshToken")});fetch(localStorage.getItem("mni.rootUrl")+"/logout",{method:"POST",headers:{Accept:"application/json"},body:e,keepalive:!0}).then((e=>e.ok)).catch((e=>{console.error(e)})),localStorage.removeItem("mni.auth.idToken"),localStorage.removeItem("mni.auth.accessToken"),localStorage.removeItem("mni.auth.expiresIn"),localStorage.removeItem("mni.auth.refreshExpiresIn"),localStorage.removeItem("mni.auth.refreshToken"),localStorage.removeItem("mni.auth.sessionState"),localStorage.removeItem("mni.auth.tokenType"),localStorage.removeItem("mni.auth.scope"),localStorage.removeItem("mni.auth.oauth")}window.location.replace(localStorage.getItem("mni.rootUrl"))}function loadScript(e,t,o="mapRender"){if(void 0===document.getElementById(o)||null==document.getElementById(o)){let n=document.createElement("script");n.setAttribute("id",o),n.setAttribute("src",e),n.onload=t(),document.head.appendChild(n)}}function togglePassword(e="password"){var t=document.getElementById(e);"password"===t.type?t.type="text":t.type="password"}function generateUUID(){var e=(new Date).getTime(),t="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(o){var n=16*Math.random();return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(t+n)%16|0,t=Math.floor(t/16)),("x"===o?n:3&n|8).toString(16)}))}function toggleDiv(e){let t=document.getElementById(e);t.style.display="none"==t.style.display?"block":"none"}function updateSelectedCountry(){let e=document.getElementById("country"),t=e.options[e.selectedIndex].value;mniSelectedCountry=t,localStorage.setItem("mni.selectedCountry",t)}function countryListPopulate(e=null){let t=localStorage.getItem("mni.country");fetch(localStorage.getItem("mni.gatewayUrl")+"/ui/countries",{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((o=>{let n=null,a=null,r=/\?country=(.*)(&|$)/g,l="<option disabled value='-1' selected='selected'> -- select a country -- </option>";if(o.length>0){o.sort();for(let e=0;e<o.length;e++)l+="<option value='"+o[e]+"'>"+o[e]+"</option>";document.getElementById("country").innerHTML=l,null!=window.location.search&&null!=(n=r.exec(window.location.search))?(a=String(n[1]).toUpperCase(),mniSelectedCountry=a,localStorage.setItem("mni.selectedCountry",a),document.getElementById("country").value=a):(mniSelectedCountry=localStorage.getItem("mni.selectedCountry"),document.getElementById("country").value=mniSelectedCountry)}else document.getElementById("country").innerHTML="<option value='"+t+"' selected='selected'>"+t+"</option>",localStorage.setItem("mni.selectedCountry",t),document.getElementById("country").value=t;null!=e&&e()})).catch((e=>{console.error(e)}))}try{"/mni/"==window.location.pathname&&(mniMetadata(),mniLicense())}catch(e){console.error(e)}