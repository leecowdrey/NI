let ductId=null,ductRawPoints=[],point=null;function updateDuctPointFromSlider(){document.getElementById("ductPoint").value=ductRawPoints[ductRawPoints.length-document.getElementById("ductPointRange").value],fetchDuct()}function fetchDuctPoints(){let e=document.getElementById("ductId");ductId=e.options[e.selectedIndex].value,"-1"!=ductId&&fetch(localStorage.getItem("ni.gatewayUrl")+"/duct/timeline/"+ductId,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(200==e.status&&toInteger(e.headers.get("Content-Length"))>0)return e.json()})).then((e=>{let t="<option disabled value='-1'> -- select a date/time -- </option>";for(var c=0;c<e.length;c++)t+=0==c?"<option selected='selected' value='"+e[c].point+"' >"+e[c].point+"</option>":"<option value='"+e[c].point+"' >"+e[c].point+"</option>",ductRawPoints.push(e[c].point);document.getElementById("ductPoint").innerHTML=t,fetchDuct()})).catch((e=>{console.error(e)}))}function fetchListDuct(){let e=document.getElementById("country"),t=e.options[e.selectedIndex].value;fetch(localStorage.getItem("ni.gatewayUrl")+"/duct?country="+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok&&200==e.status&&toInteger(e.headers.get("Content-Length"))>0)return e.json()})).then((e=>{let t=window.location.pathname.replace(localStorage.getItem("ni.rootUrl")+"/duct/",""),c="<option disabled value='-1' selected='selected'> -- select a duct -- </option>";null!=t&&(trenchIds="<option disabled value='-1'> -- select a duct -- </option>");for(var n=0;n<e.length;n++)t==e[n]?c+="<option value='"+e[n]+"' selected='selected'>"+e[n]+"</option>":c+="<option value='"+e[n]+"' >"+e[n]+"</option>";document.getElementById("ductId").innerHTML=c,null!=t&&fetchDuctPoints()})).catch((e=>{console.error(e)}))}function fetchDuct(){let e=document.getElementById("ductId");ductId=e.options[e.selectedIndex].value;let t=document.getElementById("ductPoint");point=t.options[t.selectedIndex].value;let c=document.querySelector(".grid");for(;c.firstChild;)c.removeChild(c.firstChild);fetch(localStorage.getItem("ni.gatewayUrl")+"/duct/"+ductId+"?point="+point,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok&&200==e.status&&toInteger(e.headers.get("Content-Length"))>0)return e.json()})).then((e=>{if(null!=e?.configuration){let t=0,n=1,o=48,r=24,a=0,s=0,l=0,d=0,u="historical",i=document.getElementById("country"),p=i.options[i.selectedIndex].value;null!=e.source&&(u=e.source),t=1,n=toInteger(e.configuration),n>o&&(r=Math.max(Math.ceil(n/o),o)),c.style.setProperty("--max-duct-rows",o),c.style.setProperty("--max-duct-columns",r);for(let o=0;o<t;o++)for(let t=0;t<n;t++){let n=document.createElement("div");switch(n.setAttribute("id","duct"+o+"-"+t),n.setAttribute("title",e.state),e.state){case"free":"predicted"==u?n.setAttribute("class","predictedDuctFree"):n.setAttribute("class","ductFree"),s+=1;break;case"used":"predicted"==u?n.setAttribute("class","predictedDuctUsed"):n.setAttribute("class","ductUsed"),a+=1;break;case"reserved":"predicted"==u?n.setAttribute("class","predictedDuctReserved"):n.setAttribute("class","ductReserved"),l+=1;break;case"faulty":"predicted"==u?n.setAttribute("class","predictedDuctFaulty"):n.setAttribute("class","ductFaulty"),d+=1}n.classList.add("cell"),c.appendChild(n),document.getElementById("duct"+o+"-"+t).innerHTML="<br>"+(t+1)}let g="<b>Reference:</b>&emsp;";if(null!=e.reference&&(g+=e.reference),g=g+"&emsp;( "+ductId+" )<br>&emsp;Source:&emsp;"+e.source+"<br><br>&emsp;Purpose:&emsp;"+e.purpose+"<br>&emsp;Category:&emsp;"+e.category+"<br>&emsp;Configuration:&emsp;"+e.configuration+"-way<br>",null!=e.within&&(g+='&emsp;Within Duct:&emsp; <a href="'+localStorage.getItem("ni.rootUrl")+"/duct/"+e.within+"?country="+p+'" target="_self">'+e.within+"</a><br>"),e.configuration.horizontal,e.configuration.unit,e.configuration.vertical,e.configuration.unit,g+="<br><b>Location</b>:<br>",g+='&emsp;Trench:&emsp; <a href="'+localStorage.getItem("ni.rootUrl")+"/trench/"+e.trenchId+"?country="+p+'" target="_self">'+e.trenchId+"</a><br>","duct"==e.category&&(g+="<br><b>Sub-Ducts:</b><br>",e.subduct.length>0))for(let t=0;t<e.subduct.length;t++)g+='&emsp;<a href="'+localStorage.getItem("ni.rootUrl")+"/duct/"+e.subduct[t]+"?country="+p+'" target="_self">'+e.subduct[t]+"</a><br>";g+="<br><b>Cables:</b><br>";for(let t=0;t<e.cable.length;t++)g+='&emsp; <a href="'+localStorage.getItem("ni.rootUrl")+"/cable/"+e.cable[t]+"?country="+p+'" target="_self">'+e.cable[t]+"</a><br>";g+='<br><br><b>Usage Summary:</b><br><div class="stateusage-key"><div id="stateusage-faulty" class="stateusage">Faulty: '+d+'</div><div id="stateusage-reserved" class="stateusage">Reserved: '+l+'</div><div id="stateusage-used" class="stateusage">Used: '+a+'</div><div id="stateusage-free" class="stateusage">Free: '+s+"</div></div>",document.getElementById("metadataPanel").innerHTML=g}})).catch((e=>{console.error(e)}))}try{countryListPopulate(fetchListDuct)}catch(e){console.error(e)}