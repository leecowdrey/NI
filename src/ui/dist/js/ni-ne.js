let neId=null,neRawPoints=[],point=null;var cveKnown=0,cveImpacting=0;function fetchCveNe(e=null){if(cveKnown=0,cveImpacting=0,null==e){let t=document.getElementById("neId");e=t.options[t.selectedIndex].value}fetch(localStorage.getItem("ni.gatewayUrl")+"/cve/ne/"+e,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{null!=e&&(null!=e.known&&(cveKnown=e.known.length),null!=e.impacting&&(cveImpacting=e.impacting.length))})).catch((e=>{console.error(e)}))}function fetchListNe(){let e=document.getElementById("country"),t=e.options[e.selectedIndex].value;fetch(localStorage.getItem("ni.gatewayUrl")+"/ne?country="+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{let t=window.location.pathname.replace(localStorage.getItem("ni.rootUrl")+"/ne/",""),s="<option disabled value='-1' selected='selected'> -- select a ne -- </option>";null!=t&&(trenchIds="<option disabled value='-1'> -- select a ne -- </option>");for(var o=0;o<e.length;o++)t==e[o]?s+="<option value='"+e[o]+"' selected='selected'>"+e[o]+"</option>":s+="<option value='"+e[o]+"' >"+e[o]+"</option>";document.getElementById("neId").innerHTML=s,null!=t&&fetchNePoints()})).catch((e=>{console.error(e)}))}function fetchNe(e,t=null){if(null==e){let t=document.getElementById("neId");e=t.options[t.selectedIndex].value}if(null==t){let e=document.getElementById("nePoint");t=e.options[e.selectedIndex].value}let s=document.querySelector(".grid");for(;s.firstChild;)s.removeChild(s.firstChild);fetch(localStorage.getItem("ni.gatewayUrl")+"/ne/"+e+"?point="+t,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((t=>{if(null!=t.ports){let o=document.getElementById("country"),n=o.options[o.selectedIndex].value,r=t.ports.length,a=8,i=8,l=0,c=0,d=0,u=0,p=0,m="historical";null!=t.source&&(m=t.source),r>a&&(i=Math.max(Math.ceil(r/a),a)),s.style.setProperty("--max-ne-rows",r),s.style.setProperty("--max-ne-columns",i);for(let e=0;e<t.ports.length;e++){let o=document.createElement("div");switch(o.setAttribute("id","port"+e),o.setAttribute("title",t.ports[e].name+": "+t.ports[e].state+" "+t.ports[e].configuration.rate+t.ports[e].configuration.unit+", errors: "+t.ports[e].errorCount),p+=t.ports[e].errorCount,t.ports[e].state){case"free":"predicted"==m?o.setAttribute("class","predictedPortFree"):o.setAttribute("class","portFree"),c+=1;break;case"used":"predicted"==m?o.setAttribute("class","predictedPortUsed"):o.setAttribute("class","portUsed"),l+=1;break;case"reserved":"predicted"==m?o.setAttribute("class","predictedPortReserved"):o.setAttribute("class","portReserved"),d+=1;break;case"faulty":"predicted"==m?o.setAttribute("class","predictedPortFaulty"):o.setAttribute("class","portFaulty"),u+=1}o.classList.add("cell"),s.appendChild(o);let n='<i class="fa fa-check"></i>';t.ports[e].errorCount>0&&t.ports[e].errorCount<100?n='<i class="fa fa fa-exclamation"></i>':t.ports[e].errorCount>=100&&(n='<i class="fa fa-times"></i> '),document.getElementById("port"+e).innerHTML=e+1+"<br>"+n}null==t?.decommissioned&&(t.decommissioned="");let g="<b>Host</b>:&emsp;"+t.host+"<br><center>( "+e+" )</center><br><br>Commissioned:&emsp;&emsp;"+t.commissioned+"<br>Decommissioned:&emsp;"+t.decommissioned+"<br>Source:&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"+m+"<br><br><b>Details</b>:<br>IP:&emsp;&emsp;"+t.mgmtIP+"<br>Vendor:&emsp;"+t.vendor+"<br>Model:&emsp;"+t.model+"<br>Image:&emsp;"+t.image+"<br>Version:&emsp;"+t.version+'<br><br><b>Location</b>:<br>Site:&emsp;<a href="'+localStorage.getItem("ni.rootUrl")+"/site/"+t.siteId+"?country="+n+'" target="_self">'+t.siteId+'</a><br>Rack:&emsp;<a href="'+localStorage.getItem("ni.rootUrl")+"/rack/"+t.rackId+"?country="+n+'" target="_self">'+t.rackId+"</a><br>Slot(s):&emsp;"+t.slotPosition+'<br><br><b>Usage Summary:</b><br><div class="stateusage-key"><div id="stateusage-faulty" class="stateusage">Faulty: '+u+'</div><div id="stateusage-reserved" class="stateusage">Reserved: '+d+'</div><div id="stateusage-used" class="stateusage">Used: '+l+'</div><div id="stateusage-free" class="stateusage">Free: '+c+'</div><div id="stateusage-error" class="stateusage">Errors: '+p+'</div></div><br><br><b>Common vulnerabilities and Exposures (CVE):</b><br><div class="stateusage-key"><div id="stateusage-faulty" class="stateusage">Impacting: '+cveImpacting+'</div><div id="stateusage-reserved" class="stateusage">Known: '+cveKnown+"</div></div>";document.getElementById("metadataPanel").innerHTML=g}})).catch((e=>{console.error(e)}))}function fetchNePoints(){let e=document.getElementById("neId");neId=e.options[e.selectedIndex].value,"-1"!=neId&&fetch(localStorage.getItem("ni.gatewayUrl")+"/ne/timeline/"+neId,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{neRawPoints=[];let t="<option disabled value='-1'> -- select a date/time -- </option>";for(var s=0;s<e.length;s++)t+=0==s?"<option selected='selected' value='"+e[s].point+"' >"+e[s].point+"</option>":"<option value='"+e[s].point+"' >"+e[s].point+"</option>",neRawPoints.push(e[s].point);document.getElementById("nePoint").innerHTML=t,fetchNe()})).catch((e=>{console.error(e)}))}try{countryListPopulate(fetchListNe)}catch(e){console.error(e)}