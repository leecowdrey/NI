var lineSymbol,tPath=[],tPoly=[];let trenchId=null,mapVendor=null,trenches=[],trenchCoordinates={},trenchColor="#8B0000",trenchOpacity=1,mapCenter={lat:0,lng:0},mapRenderUrl=null;var ductPanel=[],polePanel=[];let ductList=[],poleList=[];var tipObj=null;function injectTooltip(e,t){!tipObj&&e&&((tipObj=document.createElement("div")).setAttribute("class","mappolytooltip"),tipObj.innerHTML=t,document.body.appendChild(tipObj))}function deleteTooltip(e){tipObj&&(document.body.removeChild(tipObj),tipObj=null)}function fetchTrenchCountry(){try{trenchCoordinates={},trenches=[],mapCenter={lat:0,lng:0},fetch(localStorage.getItem("ni.gatewayUrl")+"/trench/geometry/country?country="+niSelectedCountry,{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{null!=e&&(null!=e.centroid&&(mapCenter={lat:e.centroid.y,lng:e.centroid.x}),null!=e.passed&&document.getElementById("trenchPremisesPassed").setAttribute("value",e.passed),null!=e.distance&&null!=e.unit&&document.getElementById("trenchDistance").setAttribute("value",e.distance+e.unit),trenchCoordinates=JSON.parse(JSON.stringify(e)),trenches=trenchCoordinates.trenches,void 0!==document.getElementById("mapRender")&&null!=document.getElementById("mapRender")&&(map.setCenter(mapCenter),drawOnMap()),loadScript(mapRenderUrl,(function(){window.displayMap=function(){map=new google.maps.Map(document.getElementById("map"),{zoom:6,center:mapCenter,mapTypeId:"hybrid",disableDefaultUI:!0}),lineSymbol={path:"M 0,-1 0,1",strokeOpacity:1,scale:4},map.setCenter(mapCenter),drawOnMap()}})))})).catch((e=>{console.error(e)}))}catch(e){console.error(e)}}function drawOnMap(){try{if(Object.keys(tPoly).length>0){for(let e in tPoly)tPoly[e].setMap(null),tPoly[e]=null;tPoly=[],tPath=[],ductList=[],poleList=[],ductPanel=[],polePanel=[]}let e=new google.maps.LatLngBounds;if(null!=trenchCoordinates){if(null!=trenches)for(let t=0;t<trenches.length;t++){let n=trenches[t];if(tPath[n]=[],tPoly[n]=[],ductList[n]="",poleList[n]="",trenchCoordinates[n].duct.length>0){ductList[n]="<ul>";for(let e=0;e<trenchCoordinates[n].duct.length;e++)ductList[n]+='<li><a href="'+localStorage.getItem("ni.rootUrl")+"/duct/"+trenchCoordinates[n].duct[e]+"?country="+niSelectedCountry+'">'+trenchCoordinates[n].duct[e]+"</a></li>";ductList[n]+="</ul>"}else ductList[n]="<ul><li>none</li></ul>";if(trenchCoordinates[n].pole.length>0){poleList[n]="<ul>";for(let e=0;e<trenchCoordinates[n].pole.length;e++)poleList[n]+='<li><a href="'+localStorage.getItem("ni.rootUrl")+"/pole/"+trenchCoordinates[n].pole[e]+"?country="+niSelectedCountry+'">'+trenchCoordinates[n].pole[e]+"</a></li>";poleList[n]+="</ul>"}else poleList="<ul><li>none</li></ul>";for(let t=0;t<trenchCoordinates[n].coordinates.length;t++)tPath[n].push({lat:trenchCoordinates[n].coordinates[t].y,lng:trenchCoordinates[n].coordinates[t].x}),e.extend({lat:trenchCoordinates[n].coordinates[t].y,lng:trenchCoordinates[n].coordinates[t].x});tPoly[n]=new google.maps.Polyline({path:tPath[n],strokeOpacity:trenchOpacity,strokeColor:trenchColor,strokeWeight:4,icons:[{icon:lineSymbol,offset:"0",repeat:"20px"}],map,title:n}),tPoly[n].setMap(map),google.maps.event.addListener(tPoly[n],"click",(function(e){ductPanel[n]=new google.maps.InfoWindow({headerContent:"Ducts",position:e.latLng,content:ductList[n]}),ductPanel[n].open({shouldFocus:!0,map})})),google.maps.event.addListener(tPoly[n],"mouseover",(function(e){injectTooltip(e,n)})),google.maps.event.addListener(tPoly[n],"mouseout",(function(e){deleteTooltip(e)})),google.maps.event.addListener(tPoly[n],"rightclick",(function(e){polePanel[n]=new google.maps.InfoWindow({headerContent:"Poles",position:e.latLng,content:poleList[n]}),polePanel[n].open({shouldFocus:!0,map})}))}map.fitBounds(e),map.setCenter(e.getCenter())}}catch(e){console.error(e)}}function fetchMapRender(){fetch(localStorage.getItem("ni.gatewayUrl")+"/ui/mapRender",{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((e=>{null!=e.vendor&&(document.getElementById("mapVendor").innerHTML="<option value='"+e.vendor+"' selected='selected'>"+e.vendor+"</option>"),null!=e.url&&(mapRenderUrl=e.url+"&loading=async&callback=displayMap&v=weekly")})).catch((e=>{console.error(e)}))}try{fetchMapRender(),countryListPopulate(fetchTrenchCountry)}catch(e){console.error(e)}