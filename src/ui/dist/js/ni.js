var niLicenseHost=null,niLicenseDomain=null,niLicenseStart=null,niLicenseExpiry=null,niAppShortName="NI",niAppIcon="/favicon.ico",niAppNotificationIcon="/favicon.ico",niAppName=null,niAppVersion=null,niAppBuild=null,niCountryCode="GBR",niCurrencyName="Sterling",niCurrencyIsoCode="GBP",niCurrencySymbol="Â£",niSelectedCountry=null,niRootUrl="/ni",niGatewayUrl=null,niGatewayUrlIp=null,niGatewayUrlDns=null,niRetryMs=1e3,niRefreshMs=6e4,niReadinessAttempts=10,niOAuthRefresh=null;const countryCode=["ABW","AFG","AGO","AIA","ALB","AND","ARE","ARG","ARM","ASM","ATA","ATF","ATG","AUS","AUT","AZE","BDI","BEL","BEN","BES","BFA","BGD","BGR","BHR","BHS","BIH","BLM","BLR","BLZ","BMU","BOL","BRA","BRB","BRN","BTN","BWA","CAF","CAN","CHE","CHL","CHN","CIV","CMR","COD","COG","COK","COL","COM","CPV","CRI","CUB","CUW","CYM","CYP","CZE","DEU","DJI","DMA","DNK","DOM","DZA","ECU","EGY","ERI","ESP","EST","ETH","FIN","FJI","FLK","FRA","FRO","FSM","GAB","GBR","GEO","GGY","GHA","GIB","GIN","GLP","GMB","GNB","GNQ","GRC","GRD","GRL","GTM","GUF","GUM","GUY","HND","HRV","HTI","HUN","IDN","IMN","IND","IRL","IRN","IRQ","ISL","ISR","ITA","JAM","JOR","JPN","KAZ","KEN","KGZ","KHM","KIR","KNA","KOR","KWT","LAO","LBN","LBR","LBY","LCA","LIE","LKA","LSO","LTU","LUX","LVA","MAR","MCO","MDA","MDG","MDV","MEX","MHL","MKD","MLI","MLT","MMR","MNE","MNG","MNP","MOZ","MRT","MSR","MTQ","MUS","MWI","MYS","MYT","NAM","NCL","NER","NGA","NIC","NIU","NLD","NOR","NPL","NRU","NZL","OMN","PAK","PAN","PCN","PER","PHL","PLW","PNG","POL","PRK","PRT","PRY","PSE","PYF","QAT","REU","ROU","RUS","RWA","SAU","SDN","SEN","SGP","SHN","SLB","SLE","SLV","SMR","SOM","SRB","SSD","STP","SUR","SVK","SVN","SWE","SWZ","SYC","SYR","TCA","TCD","TGO","THA","TJK","TKL","TKM","TLS","TON","TTO","TUN","TUR","TUV","TWN","TZA","UGA","UKR","URY","USA","UZB","VAT","VCT","VEN","VGB","VIR","VNM","VUT","WLF","WSM","YEM","ZAF","ZMB","ZWE"];function toBoolean(e){return"true"===String(e).toLowerCase()}function toPercent(e,t){let o=0;try{return t>0&&(o=Number.parseFloat(e/t*100).toFixed(0)),o}catch(e){return 0}}function toInteger(e){return Number.isNaN(Number.parseInt(e,10))?0:Number.parseInt(e,10)}function niMetadata(){try{fetch("/ni/metadata",{method:"GET",headers:{Accept:"application/json"}}).then((e=>{if(e.ok)return e.json()})).then((e=>{localStorage.setItem("ni.appName",e.name),localStorage.setItem("ni.appShortName",e.shortName),localStorage.setItem("ni.appIcon",e.icon),localStorage.setItem("ni.appNotificationIcon",e.notificatonIcon),localStorage.setItem("ni.appVersion",e.version),localStorage.setItem("ni.appBuild",e.build),localStorage.setItem("ni.country",e.country),localStorage.setItem("ni.selectedCountry",e.country),localStorage.setItem("ni.currencyName",e.currencyName),localStorage.setItem("ni.currencyIsoCode",e.currencyIsoCode),localStorage.setItem("ni.currencySymbol",e.currencySymbol),localStorage.setItem("ni.rootUrl",e.rootUrl),localStorage.setItem("ni.gatewayUrl",e.gatewayUrl),localStorage.setItem("ni.gatewayUrlIp",e.gatewayUrlIp),localStorage.setItem("ni.gatewayUrlDns",e.gatewayUrlDns),localStorage.setItem("ni.retryMs",e.retryMs),localStorage.setItem("ni.refreshMs",e.refreshMs),localStorage.setItem("ni.readinessAttempts",e.readinessAttempts),localStorage.setItem("ni.",!0)})).catch((e=>{console.error(e)})),niAppName=localStorage.getItem("ni.appName"),niAppShortName=localStorage.getItem("ni.appShortName"),niAppIcon=localStorage.getItem("ni.appIcon"),niAppNotificationIcon=localStorage.getItem("ni.appNotificationIcon"),niAppVersion=localStorage.getItem("ni.appVersion"),niAppBuild=localStorage.getItem("ni.appBuild"),niCountryCode=localStorage.getItem("ni.country"),niCurrencyName=localStorage.getItem("ni.currencyName"),niCurrencyIsoCode=localStorage.getItem("ni.currencyIsoCode"),niCurrencySymbol=localStorage.getItem("ni.currencySymbol"),niRootUrl=localStorage.getItem("ni.rootUrl"),niGatewayUrl=localStorage.getItem("ni.gatewayUrl"),niGatewayUrlIp=localStorage.getItem("ni.gatewayUrlIp"),niGatewayUrlDns=localStorage.getItem("ni.gatewayUrlDns"),niRetryMs=localStorage.getItem("ni.retryMs"),niRefreshMs=localStorage.getItem("ni.refreshMs"),niReadinessAttempts=localStorage.getItem("ni.readinessAttempts"),niSelectedCountry=localStorage.getItem("ni.selectedCountry")}catch(e){console.error(e)}}function niLicense(){try{fetch(localStorage.getItem("ni.gatewayUrl")+"/license",{method:"GET",headers:{Accept:"application/json"}}).then((e=>{if(e.ok)return e.json()})).then((e=>{localStorage.setItem("ni.license.host",e.host),localStorage.setItem("ni.license.domain",e.domain),localStorage.setItem("ni.license.start",e.start),localStorage.setItem("ni.license.expiry",e.expiry),localStorage.setItem("ni.license.",!0)})).catch((e=>{console.error(e)})),niLicenseHost=localStorage.getItem("ni.license.host"),niLicenseDomain=localStorage.getItem("ni.license.domain"),niLicenseStart=localStorage.getItem("ni.license.start"),niLicenseExpiry=localStorage.getItem("ni.license.expiry")}catch(e){console.error(e)}}function niLoadScript(e,t){let o=document.head,n=document.createElement("script");n.type="text/javascript",n.src=e,n.onreadystatechange=t,n.onload=t,o.appendChild(n)}function clearSessionStorage(){let e=localStorage.length;for(var t=0;t<e;t++)null!=localStorage.key(t)&&localStorage.key(t).startsWith("ni.")&&localStorage.removeItem(localStorage.key(t))}function dumpSessionStorage(){let e=localStorage.length;for(var t=0;t<e;t++)null!=localStorage.key(t)&&localStorage.key(t).startsWith("ni.")&&console.log(localStorage.key(t)+"="+localStorage.getItem(localStorage.key(t)))}function notify(e,t="NI",o="/favicon.ico"){"Notification"in window?"granted"===Notification.permission?new Notification(t,{body:e,icon:o}):"denied"!==Notification.permission&&Notification.requestPermission().then((e=>{"granted"===e&&new Notification("Permission request",{body:"Requesting permission to send notifications while using ni",icon:"/favicon.ico"})})):console.log("Browser does not support notifications.")}function jump(e){return window.location=e,!1}function menuJump(e){return jump(localStorage.getItem("ni.rootUrl")+"/"+e),!1}function tokenRefresh(){if(toBoolean(localStorage.getItem("ni.auth.oauth"))){null!=niOAuthRefresh&&clearTimeout(niOAuthRefresh);let e=new URLSearchParams({client_id:clientId,grant_type:"refresh_token",scope:localStorage.getItem("ni.auth.scope"),refresh_token:localStorage.getItem("ni.auth.refreshToken")});fetch(localStorage.getItem("ni.rootUrl")+"/login/refresh",{method:"POST",headers:{Accept:"application/json"},body:e,keepalive:!0}).then((e=>{if(e.ok){if(200==e.status&&toInteger(e.headers.get("Content-Length"))>0)return e.json()}else 401==e.status&&(window.alert("Authorization time-out"),window.location.replace("/"))})).then((async e=>{null!=e&&(localStorage.setItem("ni.auth.accessToken",e.access_token),localStorage.setItem("ni.auth.expiresIn",e.expires_in),localStorage.setItem("ni.auth.refreshExpiresIn",e.refresh_expires_in),localStorage.setItem("ni.auth.refreshToken",e.refresh_token),niOAuthRefresh=setTimeout(tokenRefresh,1e3*localStorage.getItem("ni.auth.refreshExpiresIn")))})).catch((e=>{console.error(e)}))}}function login(e,t,o=!1){if(null!=e&&null!=t)if(o){localStorage.setItem("ni.auth.oauth",!0);let o=new URLSearchParams({username:e,password:t});fetch(localStorage.getItem("ni.rootUrl")+"/login",{method:"POST",headers:{Accept:"application/json"},body:o,keepalive:!0}).then((e=>{if(e.ok){if(200==e.status&&toInteger(e.headers.get("Content-Length"))>0)return e.json()}else 400==e.status?(window.alert("Bad request"),window.location.replace("/")):401==e.status?(window.alert("Authorization failed\nInvalid or unknown username or password"),window.location.replace("/")):console.error(e.status,e.statusText)})).then((async e=>{null!=e&&(localStorage.setItem("ni.auth.idToken",e.id_token),localStorage.setItem("ni.auth.accessToken",e.access_token),localStorage.setItem("ni.auth.expiresIn",e.expires_in),localStorage.setItem("ni.auth.refreshExpiresIn",e.refresh_expires_in),localStorage.setItem("ni.auth.refreshToken",e.refresh_token),localStorage.setItem("ni.auth.sessionState",e.session_state),localStorage.setItem("ni.auth.tokenType",e.token_type),localStorage.setItem("ni.auth.scope",e.scope),niOAuthRefresh=setTimeout(tokenRefresh,1e3*localStorage.getItem("ni.auth.refreshExpiresIn")),window.location.replace(localStorage.getItem("ni.rootUrl")+"/readiness"))})).catch((e=>{console.error(e)}))}else localStorage.setItem("ni.auth.oauth",!1),res.sendStatus(401);else window.location.replace("/")}function logout(){if(null!=niOAuthRefresh&&clearTimeout(niOAuthRefresh),toBoolean(localStorage.getItem("ni.auth.oauth"))){let e=new URLSearchParams({access_token:localStorage.getItem("ni.auth.accessToken"),refresh_token:localStorage.getItem("ni.auth.refreshToken")});fetch(localStorage.getItem("ni.rootUrl")+"/logout",{method:"POST",headers:{Accept:"application/json"},body:e,keepalive:!0}).then((e=>e.ok)).catch((e=>{console.error(e)})),localStorage.removeItem("ni.auth.idToken"),localStorage.removeItem("ni.auth.accessToken"),localStorage.removeItem("ni.auth.expiresIn"),localStorage.removeItem("ni.auth.refreshExpiresIn"),localStorage.removeItem("ni.auth.refreshToken"),localStorage.removeItem("ni.auth.sessionState"),localStorage.removeItem("ni.auth.tokenType"),localStorage.removeItem("ni.auth.scope"),localStorage.removeItem("ni.auth.oauth")}window.location.replace(localStorage.getItem("ni.rootUrl"))}function loadScript(e,t,o="mapRender"){if(void 0===document.getElementById(o)||null==document.getElementById(o)){let n=document.createElement("script");n.setAttribute("id",o),n.setAttribute("src",e),n.onload=t(),document.head.appendChild(n)}}function togglePassword(e="password"){var t=document.getElementById(e);"password"===t.type?t.type="text":t.type="password"}function generateUUID(){var e=(new Date).getTime(),t="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(o){var n=16*Math.random();return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(t+n)%16|0,t=Math.floor(t/16)),("x"===o?n:3&n|8).toString(16)}))}function toggleDiv(e){let t=document.getElementById(e);t.style.display="none"==t.style.display?"block":"none"}function updateSelectedCountry(){let e=document.getElementById("country"),t=e.options[e.selectedIndex].value;niSelectedCountry=t,localStorage.setItem("ni.selectedCountry",t)}function countryListPopulate(e=null){let t=localStorage.getItem("ni.country");fetch(localStorage.getItem("ni.gatewayUrl")+"/ui/countries",{method:"GET",headers:{Accept:"application/json"},keepalive:!0}).then((e=>{if(e.ok)return e.json()})).then((o=>{let n=null,a=null,r=/\?country=(.*)(&|$)/g,l="<option disabled value='-1' selected='selected'> -- select a country -- </option>";if(o.length>0){o.sort();for(let e=0;e<o.length;e++)l+="<option value='"+o[e]+"'>"+o[e]+"</option>";document.getElementById("country").innerHTML=l,null!=window.location.search&&null!=(n=r.exec(window.location.search))?(a=String(n[1]).toUpperCase(),niSelectedCountry=a,localStorage.setItem("ni.selectedCountry",a),document.getElementById("country").value=a):(niSelectedCountry=localStorage.getItem("ni.selectedCountry"),document.getElementById("country").value=niSelectedCountry)}else document.getElementById("country").innerHTML="<option value='"+t+"' selected='selected'>"+t+"</option>",localStorage.setItem("ni.selectedCountry",t),document.getElementById("country").value=t;null!=e&&e()})).catch((e=>{console.error(e)}))}try{"/ni/"==window.location.pathname&&niMetadata()}catch(e){console.error(e)}