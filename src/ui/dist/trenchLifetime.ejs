<!doctype html><html class="no-js" lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><title>MNI</title><link rel="stylesheet" href="/mni/css/style.css"><link rel="stylesheet" href="/mni/css/font-awesome.min.css"><link rel="icon" href="/favicon.ico" sizes="any"><link rel="apple-touch-icon" href="img/icon.png"><style>.panel {
            width: 30%;
            height: 40%;
            border-radius: 10px;
            background-color: #b3b3b3;
            color: #ffffff;
            text-align: center;
            margin-top: 20px;
            margin-left: 20px;
            display: inline-block;
        }

        .map {
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            margin-top: 5px;
            min-height: 86vh;
        }</style><script async src="/mni/js/mni.js"></script><script defer="defer" src="./js/app.js"></script></head><body><script>var map;
        var trenchPath;
        var tPath = [];
        var tPoly = [];
        var lineSymbol;
        let fmrReady = null;
        let ftgReady = null;
        let fltReady = null;
        let ftpReady = null;
        let ftdReady = null;
        let ftppReady = null;
        let retryMs = 5000;
        let trenchId = null;
        let mapVendor = null;
        let trenchCoordinates = {};
        let trenchColor = "#8B0000";
        let trenchOpacity = 1.0;
        let startMarker = [];
        let endMarker = [];
        let mapCenter = { lat: 0, lng: 0 };
        let mapRenderUrl = null;
        function fetchTrenchPremisesPassed(id, p) {
            if (ftppReady != null) {
                clearTimeout(ftppReady);
            }

            fetch("<%=payload.gatewayUrl%>/trench/premisesPassed/" + id + "?point=" + p, {
                method: "GET",
                headers: {
                    "Accept": "application/json",
                },
            })
                .then((response) => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        ftppReady = setTimeout(fetchTrenchPremisesPassed, retryMs, id, p);
                    }
                })
                .then((data) => {
                    if (data != null) {
                        if (data.passed != null) {
                            document.getElementById("trenchPremisesPassed").setAttribute("value", data.passed);
                        }
                    }
                })
                .catch((e) => {
                    ftppReady = setTimeout(fetchTrenchPremisesPassed, retryMs, id,p);
                });

        }
        function fetchTrenchDistance(id, p) {
            if (ftdReady != null) {
                clearTimeout(ftdReady);
            }

            fetch("<%=payload.gatewayUrl%>/trench/distance/" + id + "?point=" + p, {
                method: "GET",
                headers: {
                    "Accept": "application/json",
                },
            })
                .then((response) => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        ftdReady = setTimeout(fetchTrenchDistance, retryMs, id,p);
                    }
                })
                .then((data) => {
                    if (data != null) {
                        if (data.distance != null && data.unit != null) {
                            document.getElementById("trenchDistance").setAttribute("value", data.distance + data.unit);
                        }
                    }
                })
                .catch((e) => {
                    ftdReady = setTimeout(fetchTrenchDistance, retryMs, id,p);
                });

        }
        function fetchListTrench() {
            if (fltReady != null) {
                clearTimeout(fltReady);
            }

            fetch("<%=payload.gatewayUrl%>/trench", {
                method: "GET",
                headers: {
                    "Accept": "application/json",
                },
            })
                .then((response) => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        fltReady = setTimeout(fetchListTrench, retryMs);
                    }
                })
                .then((data) => {
                    let trenchIds = "<option disabled value='-1' selected='selected'> -- select a trench -- </option>";
                    for (var i = 0; i < data.length; i++) {
                        trenchIds += "<option value='" + data[i] + "' >" + data[i] + "</option>"
                    }
                    document.getElementById("trenchId").innerHTML = trenchIds;
                    document.getElementById("trenchDistance").setAttribute("value", "");
                })
                .catch((e) => {
                    fltReady = setTimeout(fetchListTrench, retryMs);
                });

        }
        function fetchMapRender() {
            if (fmrReady != null) {
                clearTimeout(fmrReady);
            }

            fetch("<%=payload.gatewayUrl%>/ui/mapRender", {
                method: "GET",
                headers: {
                    "Accept": "application/json",
                },
            })
                .then((response) => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        fmrReady = setTimeout(fetchMapRender, retryMs);
                    }
                })
                .then((data) => {
                    if (data.vendor != null) {
                        document.getElementById("mapVendor").innerHTML = "<option value='" + data.vendor + "' selected='selected'>" + data.vendor + "</option>";
                        // <option disabled value='OpenStreet Map'>OpenStreet Map</option>
                        // <option disabled value='Microsoft Azure'>Microsoft Azure</option>
                        // <option disabled value='ERSI'>ERSI</option>
                    }
                    if (data.url != null) {
                        mapRenderUrl = data.url + "&loading=async&callback=displayMap&v=weekly";
                    }
                })
                .catch((e) => {
                    fmrReady = setTimeout(fetchMapRender, retryMs);
                });

        }
        async function wipeMapClean() {
            for (let i = 0; i < startMarker.length; i++) {
                startMarker[i].setMap(null);
                startMarker[i] = null;
            }
            for (let i = 0; i < endMarker.length; i++) {
                endMarker[i].setMap(null);
                endMarker[i] = null;
            }
            for (let i = 0; i < endMatPolyrker.length; i++) {
                tPoly[i].setMap(null);
                tPoly[i] = null;
            }
            startMarker.splice(0, startMarker.length);
            endMarker.splice(0, endMarker.length);
            tPoly.splice(0, tPoly.length);
            tPath.splice(0, tPath.length);
        }
        async function drawOnMap() {
            if (trenchCoordinates.sets.length > 0) {
                fetchTrenchPremisesPassed(trenchId, trenchCoordinates.sets[trenchCoordinates.sets.length - 1].point);
                fetchTrenchDistance(trenchId, trenchCoordinates.sets[trenchCoordinates.sets.length - 1].point);
            }
            for (let s = 0; s < trenchCoordinates.sets.length; s++) {
                let tSet = trenchCoordinates.sets[s].point;
                if (trenchCoordinates.sets[s].source == "predicted") {
                    trenchOpacity = 0;
                    if (s % 2 == 0) {
                        trenchColor = "#FFFF00";
                    } else {
                        trenchColor = "#CCCC00";
                    }
                } else {
                    trenchOpacity = 1.0;
                    if (s % 2 == 0) {
                        trenchColor = "#8B0000";
                    } else {
                        trenchColor = "#FF6600";
                    }
                }
                tPath[tSet] = [];
                for (let c = 0; c < trenchCoordinates[tSet].length; c++) {
                    if (c == 0) {
                        startMarker[tSet] = new google.maps.Marker({
                            position: { lat: trenchCoordinates[tSet][c].x, lng: trenchCoordinates[tSet][c].y },
                            icon: {
                                path: google.maps.SymbolPath.CIRCLE,
                                scale: 6,
                                strokeOpacity: 0,
                                strokeColor: trenchColor,
                                fillOpacity: 1.0,
                                fillColor: trenchColor,
                            },
                            map: map,
                            title: tSet
                        });
                    }
                    if (c == (trenchCoordinates[tSet].length - 1)) {
                        if (c > 0) {
                            endMarker[tSet] = new google.maps.Marker({
                                position: { lat: trenchCoordinates[tSet][c].x, lng: trenchCoordinates[tSet][c].y },
                                icon: {
                                    path: google.maps.SymbolPath.CIRCLE,
                                    scale: 6,
                                    strokeOpacity: 0,
                                    strokeColor: trenchColor,
                                    fillOpacity: 1.0,
                                    fillColor: trenchColor,
                                },
                                map: map,
                                title: tSet
                            });
                        }
                    }
                    tPath[tSet].push({ lat: trenchCoordinates[tSet][c].x, lng: trenchCoordinates[tSet][c].y });
                }
                tPoly[tSet] = new google.maps.Polyline({
                    path: tPath[tSet],
                    strokeOpacity: trenchOpacity,
                    strokeColor: trenchColor,
                    strokeWeight: 4,
                    icons: [
                        {
                            icon: lineSymbol,
                            offset: "0",
                            repeat: "20px",
                        },
                    ],
                    map: map,
                });
                tPoly[tSet].setMap(map);
            }
        }
        async function fetchTrenchGeometryLifetime() {
            if (ftgReady != null) {
                clearTimeout(ftgReady);
            }
            let t = document.getElementById("trenchId");
            trenchId = t.options[t.selectedIndex].value;

            await fetch("<%=payload.gatewayUrl%>/trench/geometry/lifetime/" + trenchId, {
                method: "GET",
                headers: {
                    "Accept": "application/json",
                },
            })
                .then((response) => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        ftgReady = setTimeout(fetchTrenchGeometryLifetime, retryMs);
                    }
                })
                .then((data) => {
                    if (data != null) {
                        trenchCoordinates = {};
                        trenchCoordinates = JSON.parse(JSON.stringify(data));
                        if (trenchCoordinates.sets.length > 0) {
                            let tSet = trenchCoordinates.sets[0].point;
                            if (trenchCoordinates[tSet].length > 0) {
                                mapCenter = {
                                    lat: trenchCoordinates[tSet][0].x,
                                    lng: trenchCoordinates[tSet][0].y
                                };
                            }
                        }
                    }
                    if (document.getElementById("mapRender") !== undefined && document.getElementById("mapRender") != null) {
                        map.setCenter(mapCenter);
                        wipeMapClean();
                        drawOnMap();
                    }
                })
                .catch((e) => {
                    ftgReady = setTimeout(fetchTrenchGeometryLifetime, retryMs);
                });
            loadScript(mapRenderUrl, function () {
                function displayMap() {
                    map = new google.maps.Map(document.getElementById("map"), {
                        zoom: 17,
                        center: mapCenter,
                        mapTypeId: "hybrid",
                        disableDefaultUI: true,
                    });
                    lineSymbol = {
                        path: "M 0,-1 0,1",
                        strokeOpacity: 1.0,
                        scale: 4,
                    };
                    drawOnMap();
                }
                window.displayMap = displayMap;
            });

        }
        try {
            fetchMapRender();
        } catch (e) {
            fmrReady = setTimeout(fetchMapRender, retryMs);
        }
        try {
            fetchListTrench();
        } catch (e) {
            fltReady = setTimeout(fetchListTrench, retryMs);
        }</script><div class="icon-bar" id="icon-bar"><a nohref="nohref" onmouseover="" style="cursor: pointer;" title="MarlinDT Network Intelligence"><img src="/favicon.ico" width="25%" height="25%"></a><a onmouseover="" style="cursor: pointer;" nohref="nohref" onclick="return jump('<%=payload.rootUrl%>/dashboard');" title="Dashboard"><i class="fa fa-thermometer-half"></i></a> <a onmouseover="" style="cursor: pointer;" nohref="nohref" onclick="return jump('<%=payload.rootUrl%>/cable');" title="Cables"><i class="fa fa-plug"></i></a> <a onmouseover="" style="cursor: pointer;" nohref="nohref" onclick="return jump('<%=payload.rootUrl%>/duct');" title="Ducts"><i class="fa fa-superpowers"></i></a> <a onmouseover="" style="cursor: pointer;" nohref="nohref" onclick="return jump('<%=payload.rootUrl%>/pole');" title="Poles"><i class="fa fa-arrows-v"></i></a> <a onmouseover="" style="cursor: pointer;" nohref="nohref" onclick="return jump('<%=payload.rootUrl%>/ne');" title="Network Equipment"><i class="fa fa-server"></i></a> <a onmouseover="" style="cursor: pointer;" nohref="nohref" onclick="return jump('<%=payload.rootUrl%>/rack');" title="Racks"><i class="fa fa-list-ol"></i></a> <a onmouseover="" style="cursor: pointer;" nohref="nohref" onclick="return jump('<%=payload.rootUrl%>/site');" title="Sites"><i class="fa fa-building-o"></i></a> <a onmouseover="" style="cursor: pointer;" nohref="nohref" onclick="return jump('<%=payload.rootUrl%>/service');" title="Services"><i class="fa fa-tty"></i></a> <a onmouseover="" style="cursor: pointer;" nohref="nohref" onclick="return jump('<%=payload.rootUrl%>/trench');" title="Trenches"><i class="fa fa-arrows-h"></i></a> <a onmouseover="" style="cursor: pointer;" nohref="nohref" class="active" title="Trenches (lifetime)"><i class="fa fa-vine"></i></a> <a onmouseover="" style="cursor: pointer;" nohref="nohref" onclick="return jump('<%=payload.rootUrl%>/provider');" title="Providers"><i class="fa fa-handshake-o"></i></a> <a onmouseover="" style="cursor: pointer;" nohref="nohref" onclick="return jump('<%=payload.rootUrl%>/alert');" title="Alerts"><i class="fa fa-bullhorn"></i></a> <a onmouseover="" style="cursor: pointer;" nohref="nohref" onclick="return jump('<%=payload.rootUrl%>/setting');" title="Settings"><i class="fa fa-cog"></i></a> <a nohref="nohref" onclick="window.alert('<%=payload.appName%> v<%=payload.appVersion%>.<%=payload.appBuild%>');
            return false;" title="About"><i class="fa fa-info-circle"></i></a> <a onmouseover="" style="cursor: pointer;" nohref="nohref" onclick="return jump('<%=payload.rootUrl%>/help');" title="Help"><i class="fa fa-question-circle"></i></a> <a onmouseover="" style="cursor: pointer;" nohref="nohref" onclick="logout();" title="Quit"><i class="fa fa-window-close"></i></a> <a nohref="nohref" onmouseover="" style="cursor: pointer;" accesskey="h" onclick="toggleDiv('icon-bar');return false;" title="Toggle Bar | Mac <ctrl><opt>H | Windows: <alt><shift> |"><i class="fa fa-bars"></i></a></div><div class="wrapper"><div class="mapVendor-select" id="mapVendorList"><label for="mapVendor">Map Vendor</label> <select id="mapVendor"></select></div><div class="trench-select" id="trenchList"><label for="trenchId">Trench</label> <select id="trenchId" onchange="if(this.selectedIndex !== undefined) fetchTrenchGeometryLifetime();"></select> <a accesskey="@" nohref="nohref" onclick="fetchListTrench();" onmouseover="" title="refresh" style="cursor: pointer;"><i style="color:white;" class="fa fa-refresh"></i></a> <label for="trenchDistance">Length</label> <input id="trenchDistance" disabled="disabled"> <label for="trenchPremisesPassed">Premises Passed</label> <input id="trenchPremisesPassed" disabled="disabled"></div></div><div class="map" id="map"></div><div class="footer"><p>Â© 2024-2025 Merkator nv/sa. All rights reserved.</p></div></body></html>