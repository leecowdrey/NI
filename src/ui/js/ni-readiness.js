//=====================================================================
// Network Insight (NI) - JavaScript: Readiness
//
// Corporate Headquarters:
// Cowdrey Consulting · United Kingdom · T:+447442104556
// https://www.cowdrey.net/
//
// © 2026 Cowdrey Consulting. All rights reserved.
//=====================================================================
//
let ready = null;
let attempt = 0;
let maxAttempt = 10;
document.getElementById("graffiti").innerHTML = String.fromCharCode(
  32,
  32,
  32,
  32,
  95,
  32,
  32,
  32,
  95,
  95,
  32,
  32,
  32,
  32,
  32,
  95,
  95,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  95,
  95,
  32,
  32,
  32,
  32,
  32,
  32,
  95,
  95,
  95,
  95,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  95,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  95,
  95,
  32,
  32,
  32,
  32,
  95,
  95,
  32,
  10,
  32,
  32,
  32,
  47,
  32,
  124,
  32,
  47,
  32,
  47,
  95,
  95,
  32,
  32,
  47,
  32,
  47,
  95,
  95,
  32,
  32,
  32,
  32,
  32,
  32,
  95,
  95,
  95,
  95,
  95,
  95,
  32,
  32,
  95,
  95,
  95,
  95,
  95,
  47,
  32,
  47,
  95,
  95,
  32,
  32,
  32,
  47,
  32,
  32,
  95,
  47,
  95,
  95,
  95,
  32,
  32,
  95,
  95,
  95,
  95,
  95,
  40,
  95,
  41,
  95,
  95,
  95,
  32,
  95,
  47,
  32,
  47,
  95,
  32,
  32,
  47,
  32,
  47,
  95,
  10,
  32,
  32,
  47,
  32,
  32,
  124,
  47,
  32,
  47,
  32,
  95,
  32,
  92,
  47,
  32,
  95,
  95,
  47,
  32,
  124,
  32,
  47,
  124,
  32,
  47,
  32,
  47,
  32,
  95,
  95,
  32,
  92,
  47,
  32,
  95,
  95,
  95,
  47,
  32,
  47,
  47,
  95,
  47,
  32,
  32,
  32,
  47,
  32,
  47,
  47,
  32,
  95,
  95,
  32,
  92,
  47,
  32,
  95,
  95,
  95,
  47,
  32,
  47,
  32,
  95,
  95,
  32,
  96,
  47,
  32,
  95,
  95,
  32,
  92,
  47,
  32,
  95,
  95,
  47,
  10,
  32,
  47,
  32,
  47,
  124,
  32,
  32,
  47,
  32,
  32,
  95,
  95,
  47,
  32,
  47,
  95,
  32,
  124,
  32,
  124,
  47,
  32,
  124,
  47,
  32,
  47,
  32,
  47,
  95,
  47,
  32,
  47,
  32,
  47,
  32,
  32,
  47,
  32,
  44,
  60,
  32,
  32,
  32,
  32,
  95,
  47,
  32,
  47,
  47,
  32,
  47,
  32,
  47,
  32,
  40,
  95,
  95,
  32,
  32,
  41,
  32,
  47,
  32,
  47,
  95,
  47,
  32,
  47,
  32,
  47,
  32,
  47,
  32,
  47,
  32,
  47,
  95,
  32,
  32,
  10,
  47,
  95,
  47,
  32,
  124,
  95,
  47,
  92,
  95,
  95,
  95,
  47,
  92,
  95,
  95,
  47,
  32,
  124,
  95,
  95,
  47,
  124,
  95,
  95,
  47,
  92,
  95,
  95,
  95,
  95,
  47,
  95,
  47,
  32,
  32,
  47,
  95,
  47,
  124,
  95,
  124,
  32,
  32,
  47,
  95,
  95,
  95,
  47,
  95,
  47,
  32,
  47,
  95,
  47,
  95,
  95,
  95,
  95,
  47,
  95,
  47,
  92,
  95,
  95,
  44,
  32,
  47,
  95,
  47,
  32,
  47,
  95,
  47,
  92,
  95,
  95,
  47,
  32,
  32,
  10,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  47,
  95,
  95,
  95,
  95,
  47,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  32,
  10
);
function readiness() {
  attempt++;
  let counter = ".".repeat(attempt);
  document.getElementById(
    "readiness"
  ).innerHTML = `<center><div class="loader"></div>${counter}</center>`;
  fetch(localStorage.getItem("ni.gatewayUrl") + "/api/readiness", {
    method: "GET",
    headers: {
      Accept: "application/json",
    },
    keepalive: true,
  })
    .then((response) => {
      if (response.ok) {
        return response.json();
      } else {
        if (attempt >= maxAttempt) {
          logout();
        }
        ready = setTimeout(readiness, 1000);
      }
    })
    .then((data) => {
      if (data?.point != null) {
        let datePoint = new RegExp("^[0-9]{8}T[0-9]{6}$");
        if (datePoint.test(data.point)) {
          window.location.replace(
            localStorage.getItem("ni.rootUrl") + "/dashboard"
          );
        } else {
          if (attempt >= maxAttempt) {
            logout();
          }
          ready = setTimeout(readiness, 1000);
        }
      } else {
        if (attempt >= maxAttempt) {
          logout();
        }
        ready = setTimeout(readiness, 1000);
      }
    })
    .catch((e) => {
      if (attempt >= maxAttempt) {
        logout();
      }
      ready = setTimeout(readiness, 1000);
    });
}
try {
  readiness();
} catch (e) {
  console.error(e);
  if (attempt >= maxAttempt) {
    logout();
  }
  ready = setTimeout(readiness, 10000);
}
